{
  "widgetType": "data_tables",
  "widgetSubType":"dataTableList",
  "header":"
  $header = NULL;
  $header .= widget_data_tables_export_link($node);
  return $header;
  ",
  "html_class": "initiative-table",
  "getTotalDataCount":true,
  "no_results_content":"No Results Found",
  "cleanURLParameters":[
    "year",
    "expcategory",
    "respcenter",
    "fundsrc",
    "program",
    "project"
  ],
  "urlParamMap": {
    "year":"budget_fiscal_year_id",
    "expcategory": "expenditure_type_id",
    "respcenter": "responsibility_center_id",
    "fundsrc":"funding_source_id",
    "program": "program_phase_id",
    "project": "gl_project_id"
  },
  "allowRequestParams":["widget"],
  "defaultParameters":{"budget_fiscal_year_id":119},
  "noDataInitialLoad":true,
  "dataset": "checkbook_nycha:budget_percent_difference",
  "columns": [
    "year_id.year_id",
    "proj_budget.proj_budget.gl_project_description",
    "proj_budget.proj_budget.gl_project_id",
    "percent_difference1",
    "percent_difference2",
    "percent_difference3",
    "current_amount",
    "previous_amount",
    "previous_1_amount",
    "previous_2_amount"],
  "limit":35,
  "adjustDataTableOptions":"
  $adjustDataTableOptions = $node->widgetConfig->dataTableOptions;
  $year = _getYearValueFromID(RequestUtilities::getRequestParamValue('year'));
  foreach($node->widgetConfig->table_columns as $key => $table_column){
  // Adjust the year display
  if($year == 2019 && ($table_column->column == 'percent_difference2_formatted' || $table_column->column == 'percent_difference3_formatted')){
  unset($node->widgetConfig->table_columns[$key]);
  unset($adjustDataTableOptions->aoColumns[$key]);
  }
  if($year == 2020 && ($table_column->column == 'percent_difference1_formatted' || $table_column->column == 'percent_difference3_formatted')){
  unset($node->widgetConfig->table_columns[$key]);
  unset($adjustDataTableOptions->aoColumns[$key]);
  }
  else if($year != 2019 && $year != 2020){
  if($table_column->column == 'percent_difference1_formatted' || $table_column->column == 'percent_difference2_formatted'){
  unset($node->widgetConfig->table_columns[$key]);
  unset($adjustDataTableOptions->aoColumns[$key]);
  }
  }
  $label = WidgetUtil::generateLabelMapping($table_column->labelAlias);
  $int_val = _get_num_from_string($label);

  if($int_val != 0 && $int_val < 2018){
  unset($node->widgetConfig->table_columns[$key]);
  unset($adjustDataTableOptions->aoColumns[$key]);
  }
  }
  $column_count = count($node->widgetConfig->table_columns);
  $adjustDataTableOptions->aaSorting[0][0] = $column_count - 2;

  $node->widgetConfig->table_columns = array_values($node->widgetConfig->table_columns);
  $adjustDataTableOptions->aoColumns = array_values($adjustDataTableOptions->aoColumns);
",
"adjustParameters":"
$type_filter = 'H' ;
$is_active_flag = 1;
$parameters['filter_type'] = $type_filter;
$parameters['is_active'] = $is_active_flag;
$adjustedParameters = $parameters;
if(function_exists('_checkbook_project_applyParameterFilters')){
$adjustedParameters = _checkbook_project_applyParameterFilters($node,$parameters);
}
return $adjustedParameters;
",
"derivedColumns":{
"proj_link":{
"expression":"'<a href=\"/nycha_budget'
._checkbook_project_get_url_param_string(\"year\")
._checkbook_project_get_url_param_string(\"datasource\")
.'/project/'.$row['proj_budget_proj_budget_gl_project_id']
.'\">'.$row['proj_budget_proj_budget_gl_project_description'].'</a>'"
},
"current_amount_formatted":{
"expression":"custom_number_formatter_basic_format($row['current_amount'])"
},
"percent_difference1_formatted":{
"expression": "round($row['percent_difference1'],2) . '%'"
},
"percent_difference2_formatted":{
"expression": "round($row['percent_difference2'],2) . '%'"
},
"percent_difference3_formatted":{
"expression": "round($row['percent_difference3'],2) . '%'"
},
"previous_amount_formatted":{
"expression":"custom_number_formatter_basic_format($row['previous_amount'])"
},
"previous_1_amount_formatted":{
"expression":"custom_number_formatter_basic_format($row['previous_1_amount'])"
},
"previous_2_amount_formatted":{
"expression":"custom_number_formatter_basic_format($row['previous_2_amount'])"
}
},
"table_columns": [
{
"labelAlias": "project",
"column": "proj_link",
"sortSourceColumn":"proj_budget_proj_budget_gl_project_description"
},
{
"labelAlias":"previous_2_modified",
"column":"previous_2_amount_formatted",
"sortSourceColumn":"previous_2_amount"
},
{
"labelAlias":"previous_1_modified",
"column":"previous_1_amount_formatted",
"sortSourceColumn":"previous_1_amount"
},
{
"labelAlias":"previous_modified",
"column":"previous_amount_formatted",
"sortSourceColumn":"previous_amount"
},
{
"labelAlias": "current_modified",
"column":"current_amount_formatted",
"sortSourceColumn":"current_amount"
},
{
"labelAlias":"percent_diff",
"column":"percent_difference1_formatted",
"sortSourceColumn":"percent_difference1"
},
{
"labelAlias":"percent_diff",
"column":"percent_difference2_formatted",
"sortSourceColumn":"percent_difference2"
},
{
"labelAlias":"percent_diff",
"column":"percent_difference3_formatted",
"sortSourceColumn":"percent_difference3"
},
{
"label": "",
"column": ""
}
],
"dataTableOptions":{
"aoColumns": [
{ "bSortable": true,"sWidth":"250px","sClass":"text" },
{ "bSortable": true,"sWidth":"160px","sClass":"number","asSorting": [ "desc","asc"  ] },
{ "bSortable": true,"sWidth":"160px","sClass":"number","asSorting": [ "desc","asc"  ] },
{ "bSortable": true,"sWidth":"160px" ,"sClass":"number","asSorting": [ "desc" ,"asc" ]},
{ "bSortable": true,"sWidth":"160px","sClass":"number","asSorting": [ "desc","asc"  ] },
{ "bSortable": true,"sWidth":"160px","sClass":"number","asSorting": [ "desc","asc"  ] },
{ "bSortable": true,"sWidth":"178px","sClass":"number","asSorting": [ "desc","asc"  ] },
{ "bSortable": true,"sWidth":"178px","sClass":"number","asSorting": [ "desc","asc"  ] },
{ "bSortable": true,"sWidth":"30px" }
],
"aaSorting":[[4,"desc"]],
"bRetrieve": true,
"bServerSide": true,
"bProcessing":true,
"bFilter": false,
"iDisplayLength":35,
"bPaginate": true,
"sPaginationType":"full_numbers",
"bLengthChange": false,
"sDom":"<pr><t><ip>",
"oLanguage": {
"sInfo": "Displaying transactions _START_ - _END_ of _TOTAL_",
"sProcessing":"<img src='/sites/all/themes/checkbook/images/loading_large.gif' title='Processing...'/>"
},
"bInfo": true
}
}
