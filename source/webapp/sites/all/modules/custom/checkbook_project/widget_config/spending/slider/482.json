{
    "widgetType": "phpparser",
    "no_results_content": "No Results Found",
    "cleanURLParameters":["year","calyear","agency","yeartype","mwbe","industry","vendor","subvendor","dashboard"],
    "model": {
        "join": {"method": "Union"},
        "series": [
            {
                "dataset": "checkbook:spending_transactions_all",
                "columns": ["check_amount_sum","category.category"],
                "seriesURLParamMap":{
                    "year":"check_eft_issued_nyc_year_id",
                    "calyear":"calendar_fiscal_year_id",
                    "agency":"agency_id",
                    "mwbe":"minority_type_id",
                    "industry":"industry_type_id",
                    "category":"spending_category_id"
                },
                "allowedParams":["check_eft_issued_nyc_year_id","calendar_fiscal_year_id","agency_id","minority_type_id","industry_type_id","spending_category_id","vendor_type"],
                "adjustSerieParameters":"

                $yearType = $serieParameters['year_type'][0];
                $year = $serieParameters['year_id'][0];

                if(isset($yearType)){
                if($yearType == 'B')
                    $serieParameters['check_eft_issued_nyc_year_id'] = $year;
                else if($yearType == 'C')
                    $serieParameters['calendar_fiscal_year_id'] = $year;
                }

                unset($serieParameters['year_type']);
                unset($serieParameters['year_id']);

                $vendor_type = array('P','PM');
                $is_prime_or_sub = 'P';
                $dashboard = _getRequestParamValue('dashboard');
                $vendor = _getRequestParamValue('vendor');
                $subvendor = _getRequestParamValue('subvendor');
                $bottomURL = $_REQUEST['expandBottomContURL'];
                if(isset($bottomURL)){
                    $pathParams = explode('/', $bottomURL);
                    if(preg_match('/dtsmnid/',$bottomURL)){
                        $index = array_search('dtsmnid',$pathParams);
                        $dtsmnid =  filter_xss($pathParams[($index+1)]);
                    }
                }
                if(isset($dtsmnid) && $dtsmnid == 759) { //Top 10 agencies - has sub and prime data
                    $vendor_type = array('P','PM','S','SM');
                    $is_prime_or_sub = array('P','S');
                }
                else if(isset($dashboard)) {
                    $is_prime_or_sub = preg_match('\"s\"',$dashboard) ? 'S' : 'P';
                    $vendor_type = $is_prime_or_sub == 'P' ? array('P','PM') : array('S','SM');
                }
                $serieParameters['vendor_type'] = $vendor_type;
                $serieParameters['is_prime_or_sub'] = $is_prime_or_sub;

                if(isset($vendor)) {
                    if($is_prime_or_sub == 'P') {
                        $serieParameters['vendor_id'] = $vendor;
                    }
                    else {
                        $serieParameters['prime_vendor_id'] = $vendor;
                    }
                }

                if(isset($subvendor)) {
                    $serieParameters['vendor_id'] = $subvendor;
                }
                return $serieParameters;

                "
            }
        ]
    },
    "template": "spending_bottom_slider"
}