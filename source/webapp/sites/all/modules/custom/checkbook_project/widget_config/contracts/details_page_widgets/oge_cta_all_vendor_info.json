{
"widgetType": "phpparser",
"template":"contracts_oge_cta_all_vendor_info",
"noDataInitialLoad":true,
"phpcode":"
$ag_id = _getRequestParamValue('agid');
 $q1 =    '        select
        og.vendor_id
        ,og.vendor_name
        ,sum(dlid.check_amount) check_amount_sum
        from {disbursement_line_item_details} dlid join oge_contract_vendor_level og  on
        og.fms_contract_number = dlid.contract_number AND og.vendor_id = dlid.vendor_id
        join ref_date rd1 on rd1.date_id = check_eft_issued_date_id
        where dlid.agreement_id = ' . $ag_id . '
        group by og.vendor_id, og.vendor_name;
        ';
        
        $vendors_list = _checkbook_project_execute_sql_by_data_source($q1,'checkbook_oge');
        
        $node->vendors_list = $vendors_list;
        
        
        
$q2 = '  select vendor_id, count(*) count from oge_contract og join history_agreement hm ON og.fms_contract_number = hm.contract_number
        where hm.original_agreement_id =  ' . $ag_id . '
        group by vendor_id' ;
        
        
        $vendor_contracts_count = _checkbook_project_execute_sql_by_data_source($q2,'checkbook_oge');
        $node->vendor_contracts_count = $vendor_contracts_count;
        $template = $node->widgetConfig->template;
        return theme($template, array('node'=> $node));

"
}