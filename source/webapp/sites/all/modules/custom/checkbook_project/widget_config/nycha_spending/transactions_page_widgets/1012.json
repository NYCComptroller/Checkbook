{
  "widgetType":"data_tables",
  "widgetSubType":"dataTableList",
  "stickyHeader":true,
  "cleanURLParameters":["year", "agency", "vendor", "agreement_type", "po_num_exact", "po_num", "record_type", "section8_flag",
                        "vendornm", "vendornm_exact", "checkamt", "checkamtr", "funding_id", "invoice_number", "industry", "exp_cat",
                        "category", "dept", "fundsrc", "doc_id","check_payment_status"],
  "urlParamMap":{"year":"issue_date_year_id", "agency":"agency_id", "vendor":"vendor_id", "agreement_type":"agreement_type_code",
                 "po_num_exact": "contract_id", "po_num":"contract_id", "record_type":"record_type", "section8_flag":"section8_flag",
                 "vendornm":"vendor_name","vendornm_exact":"vendor_name", "checkamt":"check_amount", "checkamtr":"check_amount",
                 "funding_id":"funding_source_id", "invoice_number":"invoice_number", "industry":"industry_type_id",
                 "exp_cat":"expenditure_type_id","category":"spending_category_id", "dept":"department_id", "fundsrc" :"funding_source_id",
                 "doc_id":"document_id"
  },
  "paramTypeConfig": {
    "vendornm": "like",
    "vendornm_exact": "eqignorecase",
    "po_num": "like",
    "po_num_exact": "eqignorecase",
    "checkamtr": "rangeid",
    "checkamt": "range"
  },
  "header":"
    $header = NULL;
    $header .= widget_data_tables_export_link($node);
    return $header;
  ",
  "exportConfigNid":1027,
  "useList":true,
  "getTotalDataCount":true,
  "limit":"35",
  "noDataInitialLoad":true,
  "html_class":"initiative-table",
  "no_results_content":"No Results Found",
  "dataset":"checkbook_nycha:all_disbursement_transactions_by_invoice_by_line",
  "uniqueSortColumn":["-sort_sequence"],
  "columns": ["issue_date", "document_id", "section8_flag", "record_type", "agreement_type_name", "contract_id", "release_number",
    "invoice_number","check_payment_status", "check_amount", "invoice_amount", "invoice_discount", "withholding_tax", "line_net_amount",
    "vendor_name", "vendor_id", "contract_purpose", "display_spending_category_name", "display_industry_type_name",
    "department_name", "start_date", "end_date", "funding_source_description", "responsibility_center_description",
    "expenditure_type_name", "program_phase_description", "gl_project_description"
  ],
  "caption":"",
  "derivedColumns": {
    "document_id_formatted":{
      "expression":"($row['document_id'] == null) ? 'N/A' : $row['document_id']"
    },
    "agreement_type_name_formatted":{
      "expression":"($row['agreement_type_name'] == null) ? '-' : $row['agreement_type_name']"
    },
    "contract_id_formatted":{
      "expression":"($row['contract_id'] == null) ? '-' : $row['contract_id']"
    },
    "release_number_formatted":{
      "expression":"($row['release_number'] == null) ? '-' : $row['release_number']"
    },
    "invoice_number_formatted":{
      "expression":"($row['invoice_number'] == null) ? '-' : _get_tooltip_markup($row['invoice_number'],24)"
    },
    "check_payment_status_formatted":{
      "expression": "(strtoupper($row['record_type']) == 'CHECK' ? (($row['check_payment_status'] == null) ? '-' : $row['check_payment_status']) : '-')"
    },
    "check_amount_formatted":{
      "expression": "(strtoupper($row['record_type']) == 'CHECK' ? (($row['check_amount'] == null) ? '-' : custom_number_formatter_basic_format($row['check_amount'])) : '-')"
    },
    "billed_amount_formatted":{
      "expression": "($row['billed_amount'] == null) ? '-' : custom_number_formatter_basic_format($row['billed_amount'])"
    },
    "invoice_discount_formatted":{
      "expression": "($row['invoice_discount'] == null) ? '-' : custom_number_formatter_basic_format($row['invoice_discount'])"
    },
    "tax_withheld_formatted":{
      "expression": "($row['withholding_tax'] == null) ? '-' : custom_number_formatter_basic_format($row['withholding_tax'])"
    },
    "amount_spent_formatted":{
      "expression": "($row['invoice_net_amount'] == null) ? '-' : custom_number_formatter_basic_format($row['invoice_net_amount'])"
    },
    "vendor_name_formatted":{
      "expression": "_get_tooltip_markup($row['vendor_name'],36)"
    },
    "vendor_link": {
      "expression": " '<a href=\"'.NychaSpendingUrlService::generateLandingPageUrl('vendor', $row['vendor_id']).'\">'.$row['vendor_name_formatted'].'</a>'"
    },
    "purpose_formatted":{
      "expression": "($row['contract_purpose'] == null) ? '-' :  _get_tooltip_markup($row['contract_purpose'],36)"
    },
    "display_industry_type_name_formatted":{
      "expression": "($row['display_industry_type_name'] == null) ? '-' :  $row['display_industry_type_name']"
    },
    "dept_formatted":{
      "expression": "($row['department_name'] == null) ? '-' :_get_tooltip_markup($row['department_name'],36)"
    },
    "start_date_formatted":{
      "expression": "($row['start_date'] == null) ? '-' : $row['start_date']"
    },
    "end_date_formatted":{
      "expression": "($row['end_date'] == null) ? '-' : $row['end_date']"
    },
    "funding_source_formatted":{
      "expression": "($row['funding_source_description'] == null) ? '-' : _get_tooltip_markup($row['funding_source_description'],36)"
    },
    "responsibility_center_formatted":{
      "expression": "($row['responsibility_center_description'] == null) ? '-' :_get_tooltip_markup($row['responsibility_center_description'],36)"
    },
    "expenditure_type_name_formatted":{
      "expression": "($row['expenditure_type_name'] == null) ? '-' : $row['expenditure_type_name']"
    },
    "program_formatted":{
      "expression": "($row['program_phase_description']== null) ? '-' :_get_tooltip_markup($row['program_phase_description'],36)"
    },
    "project_formatted":{
      "expression": "($row['gl_project_description'] == null ) ? '-' :_get_tooltip_markup($row['gl_project_description'],36)"
    }
  },
  "skipCustomPadding":true,
  "table_columns": [
    {"labelAlias":"issue_date","column":"issue_date","sortSourceColumn":"issue_date"},
    {"labelAlias":"document_id","column":"document_id_formatted","sortSourceColumn":"document_id"},
    {"labelAlias":"section8_flag","column":"section8_flag","sortSourceColumn":"section8_flag"},
    {"labelAlias":"record_type","column":"record_type","sortSourceColumn":"record_type"},
    {"labelAlias":"purchase_order_type","column":"agreement_type_name_formatted","sortSourceColumn":"agreement_type_name"},
    {"label":"","column":"", "export":false},
    {"labelAlias":"contract_id","column":"contract_id_formatted","sortSourceColumn":"contract_id"},
    {"labelAlias":"release_number","column":"release_number_formatted","sortSourceColumn":"release_number"},
    {"label":"","column":"", "export":false},
    {"labelAlias":"invoice_number","column":"invoice_number_formatted", "sortSourceColumn":"invoice_number"},
    {"labelAlias":"check_status","column":"check_payment_status_formatted", "sortSourceColumn":"check_payment_status"},
    {"labelAlias":"check_amount","column":"check_amount_formatted", "sortSourceColumn":"check_amount"},
    {"labelAlias":"billed_amount","column":"billed_amount_formatted","sortSourceColumn":"invoice_amount"},
    {"labelAlias":"invoice_discount","column":"invoice_discount_formatted","sortSourceColumn":"invoice_discount"},
    {"labelAlias":"nycha_tax_withheld","column":"tax_withheld_formatted","sortSourceColumn":"withholding_tax"},
    {"labelAlias":"amount_spent","column":"amount_spent_formatted","sortSourceColumn":"invoice_net_amount"},
    {"label":"","column":"", "export":false},
    {"labelAlias":"vendor","column":"vendor_link", "sortSourceColumn":"vendor_name"},
    {"labelAlias":"contract_purpose","column":"purpose_formatted","sortSourceColumn":"contract_purpose"},
    {"labelAlias":"spending_category","column":"display_spending_category_name","sortSourceColumn":"display_spending_category_name"},
    {"labelAlias":"industry_name","column":"display_industry_type_name_formatted","sortSourceColumn":"display_industry_type_name"},
    {"labelAlias":"dept_name","column":"dept_formatted","sortSourceColumn":"department_name"},
    {"labelAlias":"period_from","column":"start_date_formatted","sortSourceColumn":"start_date"},
    {"labelAlias":"period_to","column":"end_date_formatted","sortSourceColumn":"end_date"},
    {"labelAlias":"funding_source","column":"funding_source_formatted","sortSourceColumn":"funding_source_description"},
    {"labelAlias":"responsibility_center","column":"responsibility_center_formatted", "sortSourceColumn":"responsibility_center_description"},
    {"labelAlias":"expense_category","column":"expenditure_type_name_formatted","sortSourceColumn":"expenditure_type_name"},
    {"labelAlias":"program","column":"program_formatted", "sortSourceColumn":"program_phase_description"},
    {"labelAlias":"project","column":"project_formatted", "sortSourceColumn":"gl_project_description"},
    {"label":"","column":"", "export":false}
  ],
  "adjustParameters":"
    if(function_exists('_checkbook_project_applyParameterFilters')){
    $parameters = _checkbook_project_applyParameterFilters($node,$parameters);
    }
    return $parameters;
  ",
  "adjustDataTableOptions":"
    $adjustDataTableOptions = $node->widgetConfig->dataTableOptions;
    $adjustDataTableOptions->fnInitComplete = '##function () { new FixedColumns( oTable, {\"iLeftColumns\": 1,\"iLeftWidth\": 115} );}##';
  ",
  "dataTableOptions":{
    "bRetrieve":true,
    "bServerSide":true,
    "bProcessing":true,
    "bFilter":false,
    "bPaginate":true,
    "iDisplayLength":35,
    "sPaginationType":"full_numbers",
    "sDom":"<pr><t><ip>",
    "oLanguage": {
    "sInfo":"Displaying transactions _START_ - _END_ of _TOTAL_",
    "sProcessing":"<img src='/sites/all/themes/checkbook/images/loading_large.gif' title='Processing...'/>"
    },
    "bInfo":true,
    "aoColumns": [
      {"sClass":"text", "sWidth":"112px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"130px","asSorting":["asc","desc"]},
      {"sClass":"number-center", "sWidth":"112px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"120px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"130px","asSorting":["asc","desc"]},
      {"bSortable":false,"sWidth":"20px"},
      {"sClass":"text", "sWidth":"100px","asSorting":["asc","desc"]},
      {"sClass":"number", "sWidth":"75px","asSorting":["asc","desc"]},
      {"bSortable":false,"sWidth":"8px"},
      {"sClass":"number-center", "sWidth":"75px","asSorting":["asc","desc"]},
      {"sClass":"number-center", "sWidth":"112px","asSorting":["asc","desc"]},
      {"sClass":"number", "sWidth":"112px","asSorting":["asc","desc"]},
      {"sClass":"number", "sWidth":"112px","asSorting":["asc","desc"]},
      {"sClass":"number", "sWidth":"112px","asSorting":["asc","desc"]},
      {"sClass":"number", "sWidth":"112px","asSorting":["asc","desc"]},
      {"sClass":"number", "sWidth":"112px","asSorting":["asc","desc"]},
      {"bSortable":false,"sWidth":"20px"},
      {"sClass":"text", "sWidth":"200px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"170px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"180px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"170px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"150px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"150px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"150px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"130px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"100px","asSorting":["asc","desc"]},
      {"sClass":"number-center", "sWidth":"80px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"150px","asSorting":["asc","desc"]},
      {"sClass":"text", "sWidth":"80px","asSorting":["asc","desc"]},
      {"bSortable":false,"sWidth":"2px"}
    ],
    "aaSorting":[[0,"desc"]],
    "sScrollX":"100%",
    "bScrollCollapse": true
  },
  "customExternalJS":"
      function prepareTableListFilterUrl() {
        var oAgencyIds = getNamedFilterCriteria('fAgencyId');
        var oAgreementType = getNamedFilterCriteria('fAgreementType');
        var oPONumber = getNamedFilterCriteria('fPONumber');
        var oRecordType = getNamedFilterCriteria('fRecordType');
        var oSection8Flag = getNamedFilterCriteria('fSection8Flag');
        var oVendorIds = getNamedFilterCriteria('fvendorId');
        var oVendorNms = getNamedFilterCriteria('fvendorNm');
        var oCheckAmount = getNamedFilterCriteria('fCheckAmount');
        var oFundingIds = getNamedFilterCriteria('fFundingId');
        var oInvoiceNumber = getNamedFilterCriteria('fInvoiceNumber');
        var oIndustryIds = getNamedFilterCriteria('fIndustryId');
        var oExpCatIds = getNamedFilterCriteria('fExpCat');
        var oCatIds = getNamedFilterCriteria('fSpendCategoryId');
        var oDocIds = getNamedFilterCriteria('fDocId');

        var cUrl = oTable.fnSettings().sAjaxSource;
        var cUrlArray = cUrl.split('/');

        cUrl = adjustUrlParameter(cUrl,'agency',oAgencyIds);
        cUrl = adjustUrlParameter(cUrl,'agreement_type',oAgreementType);
        cUrl = adjustUrlParameter(cUrl,'po_num_exact',oPONumber);
        cUrl = adjustUrlParameter(cUrl,'record_type',oRecordType);
        cUrl = adjustUrlParameter(cUrl,'section8_flag',oSection8Flag);
        cUrl = adjustUrlParameter(cUrl,'vendor',oVendorIds);
        cUrl = adjustUrlParameter(cUrl,'vendornm_exact',oVendorNms);
        cUrl = adjustUrlParameter(cUrl,'checkamtr',oCheckAmount);
        cUrl = adjustUrlParameter(cUrl,'fundsrc',oFundingIds);
        cUrl = adjustUrlParameter(cUrl,'invoice_number',oInvoiceNumber);
        cUrl = adjustUrlParameter(cUrl,'category', oCatIds);
        cUrl = adjustUrlParameter(cUrl,'doc_id', oDocIds);

        return cUrl;
    }"
}
