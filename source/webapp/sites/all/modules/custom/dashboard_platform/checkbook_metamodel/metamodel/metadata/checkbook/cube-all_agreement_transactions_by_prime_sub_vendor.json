{
    "datasets": {
        "all_agreement_transactions_by_prime_sub_vendor": {
            "datasourceName":"main",
            "source":"all_agreement_transactions_by_prime_sub_vendor"
        },
        "all_agreement_transactions_by_prime_sub_vendor_name":{
            "datasourceName":"main",
            "source":"
            SELECT   'P'   AS Vendor_Type_Code,1  AS Sort_Order, v.vendor_id  AS Prime_Vendor_Id,t.prime_vendor_code AS vendor_code, v.legal_name,
            t.contract_number,t.sub_contract_id,t.prime_effective_end_year_id,t.prime_effective_begin_year_id, t.prime_starting_year_id,t.prime_ending_year_id,t.document_code,
            t.sub_latest_flag,t.prime_vendor_name as vendor_name, t.prime_dollar_difference,
            t. sub_dollar_difference
            FROM vendor v JOIN all_agreement_transactions_by_prime_sub_vendor t ON v.vendor_customer_code = t.prime_vendor_code
            WHERE  t.prime_vendor_name IS NOT NULL AND t.sub_vendor_name IS NOT NULL
            UNION ALL
            SELECT 'S'         AS Vendor_Type_Code, 2   AS Sort_Order, v.vendor_id AS Prime_Vendor_Id,	 t.sub_vendor_code, t.sub_vendor_name,t.contract_number,
            t.sub_contract_id, t.prime_effective_end_year_id, t.prime_effective_begin_year_id,t.prime_starting_year_id, t.prime_ending_year_id ,t.document_code ,t.sub_latest_flag,t.prime_vendor_name as vendor_name,  t.prime_dollar_difference,
            t. sub_dollar_difference
            FROM vendor v
            JOIN all_agreement_transactions_by_prime_sub_vendor t	 ON v.vendor_customer_code = t.prime_vendor_code
            WHERE t.prime_vendor_name IS NOT NULl AND t.sub_vendor_name IS NOT NULL	 AND t.sub_vendor_type IN ('S', 'SM')
            AND t.sub_latest_flag = 'Y'

            "
        },
        "all_agreement_transactions_by_prime_sub_vendor_type":{
            "datasourceName":"main",
            "source":"
                SELECT 'PRIME VENDOR' as vendor_type_name, 'P' as vendor_type_id, prime_vendor_type as vendor_type, prime_minority_type_id as minority_type_id, * FROM all_agreement_transactions_by_prime_sub_vendor
                WHERE prime_vendor_type IN ('P','PM')
                UNION ALL
                SELECT 'SUB VENDOR' as vendor_type_name, 'S' as vendor_type_id, sub_vendor_type as vendor_type, sub_minority_type_id as minority_type_id, * FROM all_agreement_transactions_by_prime_sub_vendor
                WHERE sub_vendor_type IN ('S','SM')
                UNION ALL
                SELECT 'M/WBE VENDOR' as vendor_type_name, 'PM' as vendor_type_id, prime_vendor_type as vendor_type, prime_minority_type_id as minority_type_id, * FROM all_agreement_transactions_by_prime_sub_vendor
                WHERE prime_vendor_type = 'PM'
                UNION ALL
                SELECT 'M/WBE VENDOR' as vendor_type_name, 'SM' as vendor_type_id, sub_vendor_type as vendor_type, sub_minority_type_id as minority_type_id, * FROM all_agreement_transactions_by_prime_sub_vendor
                WHERE sub_vendor_type = 'SM'
            "
        }
    },
    "cubes":   {
        "all_agreement_transactions_by_prime_sub_vendor": {
            "sourceDatasetName":"all_agreement_transactions_by_prime_sub_vendor",
            "dimensions": [
                {
                    "name":"agency_id",
                    "levels": [
                        {
                            "name":"agency_id",
                            "sourceColumnName":"agency_id"
                        }]
                },
                {
                    "name":"agency_name",
                    "levels": [
                        {
                            "name":"agency_name",
                            "sourceColumnName":"agency_name"
                        }]
                },
                {
                    "name":"agency_code",
                    "levels": [
                        {
                            "name":"agency_code",
                            "sourceColumnName":"agency_code"
                        }]
                },
                {
                    "name":"agreement_type_code",
                    "levels": [
                        {
                            "name":"agreement_type_code",
                            "sourceColumnName":"agreement_type_code"
                        }]
                    },
                {
                    "name":"aprv_sta",
                    "levels": [
                        {
                            "name":"aprv_sta",
                            "sourceColumnName":"aprv_sta"
                        }]
                },
                {
                    "name":"aprv_sta_name",
                    "levels": [
                        {
                            "name":"aprv_sta_name",
                            "sourceColumnName":"aprv_sta_name"
                        }]
                },
                {
                    "name":"contract_number",
                    "levels": [
                        {
                            "name":"contract_number",
                            "sourceColumnName":"contract_number"
                        }]
                },
                {
                    "name":"scntrc_status",
                    "levels": [
                        {
                            "name":"scntrc_status",
                            "sourceColumnName":"scntrc_status"
                        }]
                },
                {
                    "name":"scntrc_status_name",
                    "levels": [
                        {
                            "name":"scntrc_status_name",
                            "sourceColumnName":"scntrc_status_name"
                        }]
                },
                {
                    "name":"industry_type_id",
                    "levels": [
                        {
                            "name":"industry_type_id",
                            "sourceColumnName":"industry_type_id"
                        }]
                },
                {
                    "name":"industry_type_name",
                    "levels": [
                        {
                            "name":"industry_type_name",
                            "sourceColumnName":"industry_type_name"
                        }]
                },
                {
                    "name":"prime_industry_type_id",
                    "levels": [
                    {
                        "name":"prime_industry_type_id",
                        "sourceColumnName":"prime_industry_type_id"
                    }]
                },
                {
                    "name":"prime_industry_type_name",
                    "levels": [
                    {
                        "name":"prime_industry_type_name",
                        "sourceColumnName":"prime_industry_type_name"
                    }]
                },
                {
                    "name":"sub_industry_type_id",
                    "levels": [
                    {
                        "name":"sub_industry_type_id",
                        "sourceColumnName":"sub_industry_type_id"
                    }]
                },
                {
                    "name":"sub_industry_type_name",
                    "levels": [
                    {
                        "name":"sub_industry_type_name",
                        "sourceColumnName":"sub_industry_type_name"
                    }]
                },
                {
                    "name":"award_method_id",
                    "levels": [
                        {
                            "name":"award_method_id",
                            "sourceColumnName":"award_method_id"
                        }]
                },
                {
                    "name":"award_method_name",
                    "levels": [
                        {
                            "name":"award_method_name",
                            "sourceColumnName":"award_method_name"
                        }]
                },
                {
                    "name":"prime_minority_type_id",
                    "levels": [
                    {
                        "name":"prime_minority_type_id",
                        "sourceColumnName":"prime_minority_type_id"
                    }]
                },
                {
                    "name":"prime_minority_type_name",
                    "levels": [
                    {
                        "name":"prime_minority_type_name",
                        "sourceColumnName":"prime_minority_type_name"
                    }]
                },
                {
                    "name":"sub_minority_type_id",
                    "levels": [
                    {
                        "name":"sub_minority_type_id",
                        "sourceColumnName":"sub_minority_type_id"
                    }]
                },
                {
                    "name":"sub_minority_type_name",
                    "levels": [
                    {
                        "name":"sub_minority_type_name",
                        "sourceColumnName":"sub_minority_type_name"
                    }]
                },
                {
                    "name":"prime_amount_name",
                    "levels": [
                        {
                            "name":"prime_amount_name",
                            "sourceColumnName":"prime_amount_name"
                        }]
                },
                {
                    "name":"prime_amount_id",
                    "levels": [
                        {
                            "name":"prime_amount_id",
                            "sourceColumnName":"prime_amount_id"
                        }]
                },
                {
                    "name":"sub_amount_name",
                    "levels": [
                        {
                            "name":"sub_amount_name",
                            "sourceColumnName":"sub_amount_name"
                        }]
                },
                {
                    "name":"sub_amount_id",
                    "levels": [
                        {
                            "name":"sub_amount_id",
                            "sourceColumnName":"sub_amount_id"
                        }]
                }
            ],
            "measures": {
                "txcount": {
                    "function":"COUNT(*)"
                },
                "count_prime_mwbe": {
                    "function":"COUNT(DISTINCT prime_vendor_name||contract_number)"
                },
                "count_sub_mwbe": {
                    "function":"COUNT(DISTINCT sub_vendor_name||contract_number||sub_contract_id)"
                },
                "count_prime_records": {
                    "function":"COUNT(DISTINCT prime_vendor_name||contract_number)"
                },
                "count_sub_records": {
                    "function":"COUNT(DISTINCT sub_vendor_name||contract_number||sub_contract_id)"
                },
                "g100m_prime_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{prime_maximum_contract_amount},0) > 100000000 THEN 1 ELSE 0 END)"
                },
                "g50m_le100m_prime_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{prime_maximum_contract_amount},0) > 50000000 AND COALESCE($COLUMN{prime_maximum_contract_amount},0) <= 100000000 THEN 1 ELSE 0 END)"
                },
                "g25m_le50m_prime_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{prime_maximum_contract_amount},0) > 25000000 AND COALESCE($COLUMN{prime_maximum_contract_amount},0) <= 50000000 THEN 1 ELSE 0 END)"
                },
                "g10m_le25m_prime_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{prime_maximum_contract_amount},0) > 10000000 AND COALESCE($COLUMN{prime_maximum_contract_amount},0) <= 25000000 THEN 1 ELSE 0 END)"
                },
                "ge1m_le10m_prime_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{prime_maximum_contract_amount},0) >= 1000000 AND COALESCE($COLUMN{prime_maximum_contract_amount},0) <= 10000000 THEN 1 ELSE 0 END)"
                },
                "less1m_prime_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{prime_maximum_contract_amount},0) < 1000000 THEN 1 ELSE 0 END)"
                },
                "g100m_sub_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{sub_maximum_contract_amount},0) > 100000000 THEN 1 ELSE 0 END)"
                },
                "g50m_le100m_sub_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{sub_maximum_contract_amount},0) > 50000000 AND COALESCE($COLUMN{sub_maximum_contract_amount},0) <= 100000000 THEN 1 ELSE 0 END)"
                },
                "g25m_le50m_sub_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{sub_maximum_contract_amount},0) > 25000000 AND COALESCE($COLUMN{sub_maximum_contract_amount},0) <= 50000000 THEN 1 ELSE 0 END)"
                },
                "g10m_le25m_sub_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{sub_maximum_contract_amount},0) > 10000000 AND COALESCE($COLUMN{sub_maximum_contract_amount},0) <= 25000000 THEN 1 ELSE 0 END)"
                },
                "ge1m_le10m_sub_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{sub_maximum_contract_amount},0) >= 1000000 AND COALESCE($COLUMN{sub_maximum_contract_amount},0) <= 10000000 THEN 1 ELSE 0 END)"
                },
                "less1m_sub_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{sub_maximum_contract_amount},0) < 1000000 THEN 1 ELSE 0 END)"
                }
            }
        },
        "all_agreement_transactions_by_prime_sub_vendor_name":{
            "sourceDatasetName":"all_agreement_transactions_by_prime_sub_vendor_name",
            "dimensions":[
                {
                    "name":"prime_vendor_name",
                    "levels": [
                        {
                            "name":"prime_vendor_name",
                            "sourceColumnName":"prime_vendor_name"
                        }
                    ]
                },
                {
                    "name":"prime_vendor_code",
                    "levels": [
                        {
                            "name":"prime_vendor_code",
                            "sourceColumnName":"prime_vendor_code"
                        }
                    ]
                },
                {
                    "name":"prime_vendor_type",
                    "levels": [
                        {
                            "name":"prime_vendor_type",
                            "sourceColumnName":"prime_vendor_type"
                        }
                    ]
                },
                {
                    "name":"prime_minority_type_id",
                    "levels": [
                        {
                            "name":"prime_minority_type_id",
                            "sourceColumnName":"prime_minority_type_id"
                        }
                    ]
                },
                {
                    "name":"sub_vendor_name",
                    "levels": [
                        {
                            "name":"sub_vendor_name",
                            "sourceColumnName":"sub_vendor_name"
                        }
                    ]
                },
                {
                    "name":"sub_vendor_code",
                    "levels": [
                        {
                            "name":"sub_vendor_code",
                            "sourceColumnName":"sub_vendor_code"
                        }
                    ]
                },
                {
                    "name":"sub_vendor_type",
                    "levels": [
                        {
                            "name":"sub_vendor_type",
                            "sourceColumnName":"sub_vendor_type"
                        }
                    ]
                },
                {
                    "name":"sub_minority_type_id",
                    "levels": [
                        {
                            "name":"sub_minority_type_id",
                            "sourceColumnName":"sub_minority_type_id"
                        }
                    ]
                },
                {
                    "name":"vendor_code",
                    "levels": [
                        {
                            "name":"vendor_code",
                            "sourceColumnName":"vendor_code"
                        }
                    ]
                },
                {
                    "name":"vendor_name",
                    "levels": [
                        {
                            "name":"vendor_name",
                            "sourceColumnName":"vendor_name"
                        }
                    ]
                },
                {
                    "name":"vendor_type",
                    "levels": [
                        {
                            "name":"vendor_type",
                            "sourceColumnName":"vendor_type"
                        }
                    ]
                },
                {
                "name":"minority_type_id",
                    "levels": [
                        {
                            "name":"minority_type_id",
                            "sourceColumnName":"minority_type_id"
                        }
                    ]
                },
                {
                    "name":"minority_type_name",
                        "levels": [
                            {
                                "name":"minority_type_name",
                                "sourceColumnName":"minority_type_name"
                            }
                    ]
                },
                {
                    "name":"legal_name",
                    "levels":[
                        {
                            "name":"legal_name",
                            "sourceColumnName":"legal_name"
                        }
                    ]
                }
            ],
            "measures": {
                "txcount": {
                    "function":" COUNT(DISTINCT legal_name||contract_number||sub_contract_id  )"
                }
            }
        },
        "all_agreement_transactions_by_prime_sub_vendor_type":{
            "sourceDatasetName":"all_agreement_transactions_by_prime_sub_vendor_type",
            "dimensions":[
                {
                    "name":"prime_vendor_name",
                    "levels": [
                        {
                            "name":"prime_vendor_name",
                            "sourceColumnName":"prime_vendor_name"
                        }
                    ]
                },
                {
                    "name":"prime_vendor_code",
                    "levels": [
                        {
                            "name":"prime_vendor_code",
                            "sourceColumnName":"prime_vendor_code"
                        }
                    ]
                },
                {
                    "name":"prime_vendor_type",
                    "levels": [
                        {
                            "name":"prime_vendor_type",
                            "sourceColumnName":"prime_vendor_type"
                        }
                    ]
                },
                {
                    "name":"prime_minority_type_id",
                    "levels": [
                        {
                            "name":"prime_minority_type_id",
                            "sourceColumnName":"prime_minority_type_id"
                        }
                    ]
                },
                {
                    "name":"sub_vendor_name",
                    "levels": [
                        {
                            "name":"sub_vendor_name",
                            "sourceColumnName":"sub_vendor_name"
                        }
                    ]
                },
                {
                    "name":"sub_vendor_code",
                    "levels": [
                        {
                            "name":"sub_vendor_code",
                            "sourceColumnName":"sub_vendor_code"
                        }
                    ]
                },
                {
                    "name":"sub_vendor_type",
                    "levels": [
                        {
                            "name":"sub_vendor_type",
                            "sourceColumnName":"sub_vendor_type"
                        }
                    ]
                },
                {
                    "name":"sub_minority_type_id",
                    "levels": [
                        {
                            "name":"sub_minority_type_id",
                            "sourceColumnName":"sub_minority_type_id"
                        }
                    ]
                },
                {
                    "name": "vendor_type_id",
                    "levels": [
                        {
                            "name": "vendor_type_id",
                            "sourceColumnName": "vendor_type_id"
                        }
                    ]
                },
                {
                    "name":"vendor_type",
                    "levels": [
                        {
                            "name":"vendor_type",
                            "sourceColumnName":"vendor_type"
                        }
                    ]
                },
                {
                    "name": "vendor_type_name",
                    "levels": [
                        {
                            "name": "vendor_type_name",
                            "sourceColumnName": "vendor_type_name"
                        }
                    ]
                },
                {
                    "name": "minority_type_id",
                    "levels": [
                        {
                            "name": "minority_type_id",
                            "sourceColumnName": "minority_type_id"
                        }
                    ]
                }
            ],
            "measures": {
                "txcount": {
                    "function":"CASE WHEN vendor_type_id IN ('P','PM') THEN (COUNT(DISTINCT prime_vendor_code||contract_number)) WHEN vendor_type_id IN ('SM') THEN (COUNT(DISTINCT sub_vendor_code||contract_number||sub_contract_id)) ELSE COUNT(*) END"
                }
            }
        }
    }
}