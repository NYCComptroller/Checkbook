{
    "datasets": {
        "contract_transactions_by_sub": {
            "datasourceName":"main",
            "source":"
                SELECT prime_sub_vendor_code,prime_sub_vendor_code_by_type,prime_sub_minority_type_id,prime_sub_vendor_name_by_type,
                agreement_id,
                contract_number,
                contract_original_agreement_id,
                sub_original_contract_amount as original_contract_amount,
                agreement_type_name,
                sub_contract_id,
                master_agreement_yn,
                master_contract_number,
                master_agreement_id,
                has_children,
                has_mwbe_children,
                sub_document_version as document_version,
                sub_maximum_contract_amount as maximum_contract_amount,
                sub_dollar_difference as dollar_difference,
                sub_percent_difference as percent_difference,
                sub_purpose as description,
                scntrc_status,
                scntrc_status_name,
                prime_vendor_id,
                prime_vendor_name,
                prime_minority_type_id,
                prime_minority_type_name,
                sub_vendor_id,
                sub_vendor_name,
                sub_minority_type_id,
                sub_minority_type_name,
                aprv_sta,
                aprv_sta_name,
                agency_id,
                agency_name,
                award_method_name,award_method_id
                industry_type_name,industry_type_id,
                expenditure_object_names,
                sub_effective_begin_date as effective_begin_date,
                sub_effective_end_date as effective_end_date,
                registered_date,
                tracking_number,
                brd_awd_no,
                document_code,
                original_agreement_id,
                sub_spent_to_date as rfed_amount,
                sub_starting_year_id as starting_year_id,
                sub_ending_year_id as ending_year_id,
                sub_effective_begin_year_id as effective_begin_year_id,
                sub_effective_end_year_id as effective_end_year_id
                FROM all_agreement_transactions_by_prime_vendor
                "
        },
        "contract_transactions_by_sub_vendor_facet_data":{
            "datasourceName":"main",
            "source":"
                SELECT vendor_code,vendor_name,vendor_type_name,vendor_type,minority_type_id,minority_type_name,
                agreement_id,
                contract_number,
                contract_original_agreement_id,
                sub_original_contract_amount as original_contract_amount,
                agreement_type_name,
                sub_contract_id,
                master_agreement_yn,
                master_contract_number,
                master_agreement_id,
                has_children,
                has_mwbe_children,
                sub_document_version as document_version,
                sub_maximum_contract_amount as maximum_contract_amount,
                sub_dollar_difference as dollar_difference,
                sub_percent_difference as percent_difference,
                sub_purpose as description,
                scntrc_status,
                scntrc_status_name,
                prime_vendor_id,
                prime_vendor_name,
                prime_minority_type_id,
                prime_minority_type_name,
                sub_vendor_id,
                sub_vendor_name,
                sub_minority_type_id,
                sub_minority_type_name,
                aprv_sta,
                aprv_sta_name,
                agency_id,
                agency_name,
                award_method_name,award_method_id,
                industry_type_name,industry_type_id,
                expenditure_object_names,
                sub_effective_begin_date as effective_begin_date,
                sub_effective_end_date as effective_end_date,
                registered_date,
                tracking_number,
                brd_awd_no,
                document_code,
                original_agreement_id,
                sub_spent_to_date as rfed_amount,
                sub_starting_year_id as starting_year_id,
                sub_ending_year_id as ending_year_id,
                sub_effective_begin_year_id as effective_begin_year_id,
                sub_effective_end_year_id as effective_end_year_id
                FROM
                (
                    SELECT prime_vendor_code as vendor_code, prime_vendor_name as vendor_name, 'PRIME' as vendor_type_name,
                    CASE WHEN prime_minority_type_id IN (2,3,4,5,9) THEN 'PM' ELSE 'P' END as vendor_type,
                    prime_minority_type_id as minority_type_id, prime_minority_type_name as minority_type_name, *
                    FROM all_agreement_transactions_by_prime_vendor
                    WHERE prime_sub_vendor_code_by_type ~* '(^P:.*$)|(.*,P:.*$)|(^P:.*,.*)|(^PM:.*$)|(.*,PM:.*$)|(^PM:.*,.*)'

                    UNION ALL

                    SELECT sub_vendor_code as vendor_code, sub_vendor_name as vendor_name, 'SUB' as vendor_type_name,
                    CASE WHEN sub_minority_type_id IN (2,3,4,5,9) THEN 'SM' ELSE 'S' END as vendor_type,
                    sub_minority_type_id as minority_type_id, sub_minority_type_name as minority_type_name, *
                    FROM all_agreement_transactions_by_prime_vendor
                    WHERE prime_sub_vendor_code_by_type ~* '(^S:.*$)|(.*,S:.*$)|(^S:.*,.*)|(^SM:.*$)|(.*,SM:.*$)|(^SM:.*,.*)'
                ) query
                "
        },
        "contract_transactions_by_sub_vendor_type_facet_data":{
            "datasourceName":"main",
            "source":"
                SELECT vendor_type_name,vendor_type_id,vendor_code,vendor_name,minority_type_id,vendor_type
                agreement_id,
                contract_number,
                contract_original_agreement_id,
                sub_original_contract_amount as original_contract_amount,
                agreement_type_name,
                sub_contract_id,
                master_agreement_yn,
                master_contract_number,
                master_agreement_id,
                has_children,
                has_mwbe_children,
                sub_document_version as document_version,
                sub_maximum_contract_amount as maximum_contract_amount,
                sub_dollar_difference as dollar_difference,
                sub_percent_difference as percent_difference,
                sub_purpose as description,
                scntrc_status,
                scntrc_status_name,
                prime_vendor_id,
                prime_vendor_name,
                prime_minority_type_id,
                prime_minority_type_name,
                sub_vendor_id,
                sub_vendor_name,
                sub_minority_type_id,
                sub_minority_type_name,
                aprv_sta,
                aprv_sta_name,
                agency_id,
                agency_name,
                award_method_name,award_method_id,
                industry_type_name,industry_type_id,
                expenditure_object_names,
                sub_effective_begin_date as effective_begin_date,
                sub_effective_end_date as effective_end_date,
                registered_date,
                tracking_number,
                brd_awd_no,
                document_code,
                original_agreement_id,
                sub_spent_to_date as rfed_amount,
                sub_starting_year_id as starting_year_id,
                sub_ending_year_id as ending_year_id,
                sub_effective_begin_year_id as effective_begin_year_id,
                sub_effective_end_year_id as effective_end_year_id
                FROM (
                    SELECT 'PRIME VENDOR' vendor_type_name, 'P' as vendor_type_id, prime_vendor_code as vendor_code, prime_vendor_name as vendor_name, prime_minority_type_id as minority_type_id, CASE WHEN prime_minority_type_id IN (2,3,4,5,9) THEN 'PM' ELSE 'P' END as vendor_type, * FROM all_agreement_transactions_by_prime_vendor
                    WHERE prime_sub_vendor_code_by_type ~* '(^P:.*$)|(.*,P:.*$)|(^P:.*,.*)|(^PM:.*$)|(.*,PM:.*$)|(^PM:.*,.*)'
                    UNION ALL
                    SELECT 'SUB VENDOR' as vendor_type_name, 'S' as vendor_type_id, sub_vendor_code as vendor_code, sub_vendor_name as vendor_name, sub_minority_type_id as minority_type_id, CASE WHEN sub_minority_type_id IN (2,3,4,5,9) THEN 'SM' ELSE 'S' END as vendor_type, * FROM all_agreement_transactions_by_prime_vendor
                    WHERE prime_sub_vendor_code_by_type ~* '(^S:.*$)|(.*,S:.*$)|(^S:.*,.*)|(^SM:.*$)|(.*,SM:.*$)|(^SM:.*,.*)'
                    UNION ALL
                    SELECT 'M/WBE VENDOR' vendor_type_name, 'M' as vendor_type_id, prime_vendor_code as vendor_code, prime_vendor_name as vendor_name, prime_minority_type_id as minority_type_id, CASE WHEN prime_minority_type_id IN (2,3,4,5,9) THEN 'PM' ELSE 'P' END as vendor_type, * FROM all_agreement_transactions_by_prime_vendor
                    WHERE prime_sub_vendor_code_by_type ~* '(^PM:.*$)|(.*,PM:.*$)|(^PM:.*,.*)'
                    UNION ALL
                    SELECT 'M/WBE VENDOR' as vendor_type_name, 'M' as vendor_type_id, sub_vendor_code as vendor_code, sub_vendor_name as vendor_name, sub_minority_type_id as minority_type_id, CASE WHEN sub_minority_type_id IN (2,3,4,5,9) THEN 'SM' ELSE 'S' END as vendor_type, * FROM all_agreement_transactions_by_prime_vendor
                    WHERE prime_sub_vendor_code_by_type ~* '(^SM:.*$)|(.*,SM:.*$)|(^SM:.*,.*)'
                ) query
                "
        }
    },
    "cubes":{
        "contract_transactions_by_sub": {
            "sourceDatasetName":"contract_transactions_by_sub",
            "dimensions": [
                {
                    "name":"agency_id",
                    "levels": [
                        {
                            "name":"agency_id",
                            "sourceColumnName":"agency_id"
                        }]
                },
                {
                    "name":"agency_name",
                    "levels": [
                        {
                            "name":"agency_name",
                            "sourceColumnName":"agency_name"
                        }]
                },
                {
                    "name":"aprv_sta",
                    "levels": [
                        {
                            "name":"aprv_sta",
                            "sourceColumnName":"aprv_sta"
                        }]
                },
                {
                    "name":"aprv_sta_name",
                    "levels": [
                        {
                            "name":"aprv_sta_name",
                            "sourceColumnName":"aprv_sta_name"
                        }]
                },
                {
                    "name":"contract_number",
                    "levels": [
                        {
                            "name":"contract_number",
                            "sourceColumnName":"contract_number"
                        }]
                },
                {
                    "name":"scntrc_status",
                    "levels": [
                        {
                            "name":"scntrc_status",
                            "sourceColumnName":"scntrc_status"
                        }]
                },
                {
                    "name":"scntrc_status_name",
                    "levels": [
                        {
                            "name":"scntrc_status_name",
                            "sourceColumnName":"scntrc_status_name"
                        }]
                },
                {
                    "name":"industry_type_id",
                    "levels": [
                        {
                            "name":"industry_type_id",
                            "sourceColumnName":"industry_type_id"
                        }]
                },
                {
                    "name":"industry_type_name",
                    "levels": [
                        {
                            "name":"industry_type_name",
                            "sourceColumnName":"industry_type_name"
                        }]
                },
                {
                    "name":"award_method_id",
                    "levels": [
                        {
                            "name":"award_method_id",
                            "sourceColumnName":"award_method_id"
                        }]
                },
                {
                    "name":"award_method_name",
                    "levels": [
                        {
                            "name":"award_method_name",
                            "sourceColumnName":"award_method_name"
                        }]
                }
            ],
            "measures": {
                "txcount": {
                    "function":"COUNT(*)"
                },
                "g100m_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{maximum_contract_amount},0) > 100000000 THEN 1 ELSE 0 END)"
                },
                "g50m_le100m_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{maximum_contract_amount},0) > 50000000 AND COALESCE($COLUMN{maximum_contract_amount},0) <= 100000000 THEN 1 ELSE 0 END)"
                },
                "g25m_le50m_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{maximum_contract_amount},0) > 25000000 AND COALESCE($COLUMN{maximum_contract_amount},0) <= 50000000 THEN 1 ELSE 0 END)"
                },
                "g10m_le25m_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{maximum_contract_amount},0) > 10000000 AND COALESCE($COLUMN{maximum_contract_amount},0) <= 25000000 THEN 1 ELSE 0 END)"
                },
                "ge1m_le10m_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{maximum_contract_amount},0) >= 1000000 AND COALESCE($COLUMN{maximum_contract_amount},0) <= 10000000 THEN 1 ELSE 0 END)"
                },
                "less1m_count": {
                    "function": "SUM(CASE WHEN COALESCE($COLUMN{maximum_contract_amount},0) < 1000000 THEN 1 ELSE 0 END)"
                }
            }
        },
        "contract_transactions_by_sub_vendor_facet_data":{
            "sourceDatasetName":"contract_transactions_by_sub_vendor_facet_data",
            "dimensions":[
                {
                    "name":"vendor_name",
                    "levels": [
                        {
                            "name":"vendor_name",
                            "sourceColumnName":"vendor_name"
                        }
                    ]
                },
                {

                    "name":"vendor_code",
                    "levels": [
                        {
                            "name":"vendor_code",
                            "sourceColumnName":"vendor_code"
                        }
                    ]
                },
                {
                    "name":"vendor_type_name",
                    "levels": [
                        {
                            "name":"vendor_type_name",
                            "sourceColumnName":"vendor_type_name"
                        }
                    ]
                },
                {
                    "name":"vendor_type",
                    "levels": [
                        {
                            "name":"vendor_type",
                            "sourceColumnName":"vendor_type"
                        }
                    ]
                },
                {
                    "name":"minority_type_name",
                    "levels": [
                        {
                            "name":"minority_type_name",
                            "sourceColumnName":"minority_type_name"
                        }
                    ]
                },
                {
                    "name":"minority_type_id",
                    "levels": [
                        {
                            "name":"minority_type_id",
                            "sourceColumnName":"minority_type_id"
                        }
                    ]
                }
            ],
            "measures": {
                "txcount": {
                    "function":"COUNT(*)"
                }
            }
        },
        "contract_transactions_by_sub_vendor_type_facet_data":{
            "sourceDatasetName":"contract_transactions_by_sub_vendor_type_facet_data",
            "dimensions":[
                {
                    "name": "vendor_type_name",
                    "levels": [
                        {
                            "name": "vendor_type_name",
                            "sourceColumnName": "vendor_type_name"
                        }
                    ]
                },
                {
                    "name": "vendor_type_id",
                    "levels": [
                        {
                            "name": "vendor_type_id",
                            "sourceColumnName": "vendor_type_id"
                        }
                    ]
                },
                {
                    "name": "vendor_type",
                    "levels": [
                        {
                            "name": "vendor_type",
                            "sourceColumnName": "vendor_type"
                        }
                    ]
                },
                {
                    "name": "minority_type_id",
                    "levels": [
                        {
                            "name": "minority_type_id",
                            "sourceColumnName": "minority_type_id"
                        }
                    ]
                },
                {
                    "name": "vendor_code",
                    "levels": [
                        {
                            "name": "vendor_code",
                            "sourceColumnName": "vendor_code"
                        }
                    ]
                },
                {
                    "name": "vendor_name",
                    "levels": [
                        {
                            "name": "vendor_name",
                            "sourceColumnName": "vendor_name"
                        }
                    ]
                }
            ],
            "measures": {
                "txcount": {
                    "function": "COUNT(*)"
                }
            }
        }
    }
}