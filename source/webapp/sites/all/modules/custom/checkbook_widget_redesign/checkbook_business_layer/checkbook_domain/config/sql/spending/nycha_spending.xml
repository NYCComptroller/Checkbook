<statements>
  <!--GetSpendingByChecks-->
  <statement name="GetNychaSpendingByChecks" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="vendor" type="int" />
    <param name="category" type="int" />
    <sql>
      SELECT
        issue_date,
        vendor_name,
        vendor_id,
        display_expenditure_object_name as expense_category,
        check_amount
      FROM all_disbursement_transactions
      <where>
        <exp op="AND">
          <exp op="=" dbField="issue_date_year_id" paramName="year" />
          <exp op="=" dbField="spending_category_id" paramName="category"/>
          <exp op="=" dbField="vendor_id" paramName="vendor" />
        </exp>
      </where>
      GROUP BY issue_date, vendor_name, vendor_id, display_expenditure_object_name, check_amount
    </sql>
  </statement>
  <!--GetNychaSpendingByExpenseCategories-->
  <statement name="GetNychaSpendingByExpenseCategories" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="vendor" type="int" />
    <param name="category" type="int" />
    <sql>
      SELECT
        display_expenditure_object_name AS expenditure_object_name,
        SUM(s0.check_amount) AS check_amount_sum
      FROM all_disbursement_transactions s0
      JOIN
      (
      SELECT SUM(check_amount) AS check_amount
      FROM all_disbursement_transactions
      <where>
        <exp op="AND">
          <exp op="=" dbField="issue_date_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
          <exp op="=" dbField="spending_category_id" paramName="category" />
        </exp>
      </where>
      ) total ON 1 = 1
      <where>
        <exp op="AND">
          <exp op="=" dbField="s0.issue_date_year_id" paramName="year" />
          <exp op="=" dbField="s0.vendor_id" paramName="vendor" />
          <exp op="=" dbField="s0.spending_category_id" paramName="category" />
        </exp>
      </where>
      GROUP BY display_expenditure_object_name
    </sql>
  </statement>
  <!--GetNychaSpendingByVendors-->
  <statement name="GetNychaSpendingByVendors" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="vendor" type="int" />
    <param name="category" type="int" />
    <sql>
      SELECT
        vendor_name,
        vendor_id,
        SUM(s0.check_amount) AS check_amount_sum,
        SUM(s0.invoice_net_amount) AS total_contract_amount_sum
      FROM all_disbursement_transactions s0
      JOIN
      (
      SELECT SUM(check_amount) AS check_amount
      FROM all_disbursement_transactions
      <where>
        <exp op="AND">
          <exp op="=" dbField="issue_date_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
          <exp op="=" dbField="spending_category_id" paramName="category" />
        </exp>
      </where>
      ) total ON 1 = 1
      <where>
        <exp op="AND">
          <exp op="=" dbField="s0.issue_date_year_id" paramName="year" />
          <exp op="=" dbField="s0.vendor_id" paramName="vendor" />
          <exp op="=" dbField="s0.spending_category_id" paramName="category" />
        </exp>
      </where>
      GROUP BY vendor_name, vendor_id
    </sql>
  </statement>
  <!--GetNychaSpendingByContracts-->
  <statement name="GetNychaSpendingByContracts" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="vendor" type="int" />
    <param name="category" type="int" />
    <sql>
      SELECT contract_id,
      description AS contract_purpose,
      vendor_name,
      vendor_id,
      SUM(check_amount) AS ytd_spending,
      SUM(line_amount) AS total_contract_amount
      FROM all_disbursement_transactions
      <where>
        <exp op="AND">
          <exp op="=" dbField="issue_date_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
          <exp op="=" dbField="spending_category_id" paramName="category" />
        </exp>
      </where>
      GROUP BY contract_id, description, vendor_name, vendor_id
    </sql>
  </statement>
  <!--GetCountContracts-->
  <statement name="GetCountContracts" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="vendor" type="int" />
    <param name="category" type="int" />
    <sql>
      SELECT DISTINCT contract_id AS contract_id FROM all_disbursement_transactions
      <where>
        <exp op="AND">
          <exp op="=" dbField="issue_date_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
          <exp op="=" dbField="spending_category_id" paramName="category" />
        </exp>
      </where>
    </sql>
  </statement>
  <!--GetNychaSpendingByIndustries-->
  <statement name="GetNychaSpendingByIndustries" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="vendor" type="int" />
    <param name="category" type="int" />
    <sql>
      SELECT
        s0.industry_type_id,
        s0.display_industry_type_name AS industry_type_name,
        SUM(s0.check_amount) AS check_amount_sum
      FROM all_disbursement_transactions s0
      JOIN
      (
      SELECT SUM(check_amount) AS check_amount FROM all_disbursement_transactions
      <where>
        <exp op="AND">
          <exp op="=" dbField="issue_date_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
          <exp op="=" dbField="spending_category_id" paramName="category" />
        </exp>
      </where>
      ) total on 1 = 1
      <where>
        <exp op="AND">
          <exp op="=" dbField="issue_date_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
          <exp op="=" dbField="spending_category_id" paramName="category" />
        </exp>
      </where>
      GROUP BY s0.industry_type_id, s0.display_industry_type_name
    </sql>
  </statement>
  <!--GetNychaSpendingByFundingSource-->
  <statement name="GetNychaSpendingByFundingSource" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="vendor" type="int" />
    <param name="category" type="int" />
    <sql>
      SELECT
      s0.funding_source_id,
      s0.display_funding_source_descr AS funding_source_name,
      SUM(s0.check_amount) AS check_amount_sum
      FROM all_disbursement_transactions s0
      JOIN
      (
      SELECT SUM(check_amount) AS check_amount FROM all_disbursement_transactions
      <where>
        <exp op="AND">
          <exp op="=" dbField="issue_date_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
          <exp op="=" dbField="spending_category_id" paramName="category" />
        </exp>
      </where>
      ) total on 1 = 1
      <where>
        <exp op="AND">
          <exp op="=" dbField="s0.issue_date_year_id" paramName="year" />
          <exp op="=" dbField="s0.vendor_id" paramName="vendor" />
          <exp op="=" dbField="s0.spending_category_id" paramName="category" />
        </exp>
      </where>
      GROUP BY s0.funding_source_id, s0.display_funding_source_descr
    </sql>
  </statement>
  <!--GetNychaSpendingByDepartment-->
  <statement name="GetNychaSpendingByDepartment" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="vendor" type="int" />
    <param name="category" type="int" />
    <sql>
      SELECT
      s0.department_id,
      s0.department_name,
      SUM(s0.check_amount) AS check_amount_sum
      FROM all_disbursement_transactions s0
      JOIN
      (
      SELECT SUM(check_amount) AS check_amount FROM all_disbursement_transactions
      <where>
        <exp op="AND">
          <exp op="=" dbField="issue_date_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
          <exp op="=" dbField="spending_category_id" paramName="category" />
        </exp>
      </where>
      ) total on 1 = 1
      <where>
        <exp op="AND">
          <exp op="=" dbField="s0.issue_date_year_id" paramName="year" />
          <exp op="=" dbField="s0.vendor_id" paramName="vendor" />
          <exp op="=" dbField="s0.spending_category_id" paramName="category" />
        </exp>
      </where>
      GROUP BY s0.department_id, s0.department_name
    </sql>
  </statement>
</statements>
