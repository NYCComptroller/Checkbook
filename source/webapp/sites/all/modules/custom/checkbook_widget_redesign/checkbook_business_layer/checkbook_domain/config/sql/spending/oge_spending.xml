<statements>
    <statement name="GetOGESpendingByChecksAgency" datasource="checkbook_oge">
        <param name="year" required ="true"/>
        <param name="category" type="int"/>
        <param name="agency" type="int"/>
        <sql>
            SELECT
            check_eft_issued_date,
            vendor_name,
            agency_name,
            check_amount,
            expenditure_object_name as expense_category,
            agency_id,
            vendor_id,
            expenditure_object_id,
            department_name
            FROM disbursement_line_item_details
            <where>
                <exp op="AND">
                    <exp op="=" dbField="check_eft_issued_nyc_year_id" paramName="year" />
                    <exp op="IN" dbField="agency_id" paramName="agency"/>
                    <exp op="=" dbField="spending_category_id" paramName="category"/>
                </exp>
            </where>
        </sql>
    </statement>
    <statement name="GetOGESpendingByChecksVendors" datasource="checkbook">
        <param name="year" required ="true"/>
        <param name="category" type="int"/>
        <param name="vendor" type="int"/>
        <sql>
            SELECT
            check_eft_issued_date,
            vendor_name,
            agency_name,
            check_amount,
            expenditure_object_name as expense_category,
            agency_id,
            vendor_id,
            expenditure_object_id,
            department_name
            FROM disbursement_line_item_details
            <where>
                <exp op="AND">
                    <exp op="=" dbField="check_eft_issued_nyc_year_id" paramName="year" />
                    <exp op="IN" dbField="vendor_id" paramName="vendor"/>
                    <exp op="=" dbField="spending_category_id" paramName="category"/>
                </exp>
            </where>
        </sql>
    </statement>
<!--GetOGESpendingByExpenseCategories-->
    <statement name="GetOGESpendingByExpenseCategories" datasource="checkbook_oge">
         <param name="year" required ="true" type="int" />
        <param name="yeartype" required ="true" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="fvendor" type="int" />
        <param name="category" type="int" />
        <param name="industry" type="int" />
        <param name="mwbe"/>
        <sql>
        SELECT s0.type_of_year,
            s0.year_id,
            s0.expenditure_object_id,
            j1.original_expenditure_object_name AS expenditure_object_name,
            SUM(total_spending_amount) AS check_amount_sum
        FROM aggregateon_spending_coa_entities s0
        JOIN ref_expenditure_object j1 ON j1.expenditure_object_id = s0.expenditure_object_id
        <where>
            <exp op="AND">
                <exp op="=" dbField="s0.year_id" paramName="year" />
                <exp op="=" dbField="s0.type_of_year" paramName="yeartype" />
                <exp op="=" dbField="s0.vendor_id" paramName="vendor" />
                <exp op="=" dbField="s0.vendor_id" paramName="fvendor" />
                <exp op="=" dbField="s0.agency_id" paramName="agency" />
                <exp op="=" dbField="s0.spending_category_id" paramName="category" />
                <exp op="=" dbField="s0.industry_type_id" paramName="industry" />
                <exp op="IN" dbField="s0.minority_type_id" paramName="mwbe" />
            </exp>
        </where>
        GROUP BY s0.year_id, s0.type_of_year, s0.expenditure_object_id, j1.original_expenditure_object_name
        </sql>
    </statement>
<!--GetOGESpendingByPrimeVendors-->
    <statement name="GetOGESpendingByPrimeVendors" datasource="checkbook_oge">
        <param name="year" required ="true"/>
        <param name="category" type="int"/>
        <param name="yeartype" required="true" type="string"/>
        <param name="agency" type="int"/>
        <sql>
            SELECT
            a.type_of_year AS yeartype_yeartype,
            a.year_id AS year_year,
            a.vendor_id AS vendor,
            SUM(COALESCE(total_spending_amount,0)) AS check_amount_sum,
            MAX(COALESCE(total_contract_amount,0)) AS total_contract_amount_sum,
            b.legal_name AS vendor_name
            FROM aggregateon_spending_vendor a
            JOIN vendor b ON b.vendor_id = a.vendor_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="=" dbField="a.spending_category_id" paramName="category" />
                </exp>
            </where>
            GROUP BY a.vendor_id, a.year_id, a.type_of_year,b.legal_name
        </sql>
    </statement>
<!--GetOGESpendingByDepartments-->
    <statement name="GetOGESpendingByDepartments" datasource="checkbook_oge">
        <param name="year" required ="true" type="int" />
        <param name="yeartype" required ="true" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="fvendor" type="int" />
        <param name="category" type="int" />
        <param name="industry" type="int" />
        <param name="mwbe"/>
        <sql>
            SELECT s0.year_id,
                   s0.agency_id,
                   s0.department_id,
                   SUM(total_spending_amount) AS check_amount_sum,
                   d.department_name
            FROM aggregateon_spending_coa_entities s0
            JOIN ref_department d ON d.department_id = s0.department_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="s0.year_id" paramName="year" />
                    <exp op="=" dbField="s0.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="s0.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="s0.vendor_id" paramName="fvendor" />
                    <exp op="=" dbField="s0.agency_id" paramName="agency" />
                    <exp op="=" dbField="s0.spending_category_id" paramName="category" />
                    <exp op="=" dbField="s0.industry_type_id" paramName="industry" />
                    <exp op="IN" dbField="s0.minority_type_id" paramName="mwbe" />
                </exp>
            </where>
            GROUP BY s0.agency_id, s0.department_id, s0.year_id, d.department_name
        </sql>
    </statement>
</statements>

