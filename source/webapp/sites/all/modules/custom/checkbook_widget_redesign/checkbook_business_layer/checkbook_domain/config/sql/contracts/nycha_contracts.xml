<statements>
  <!--GetNychaVendors-->
  <statement name="GetContractsByVendors" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int"/>
    <param name="vendor" type="int"/>
    <sql>
      SELECT vendor_name,
        vendor_id,
        SUM(purchase_order_count) AS purchase_order_count,
        SUM(spend_to_date) AS spend_to_date,
        SUM(total_amount) AS total_amount,
        SUM(original_amount) AS original_amount
      FROM contracts_fy_vendor_summary_vw
      <where>
        <exp op="AND">
          <exp op="=" dbField="fiscal_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
        </exp>
      </where>
      GROUP BY vendor_id, vendor_name
    </sql>
  </statement>
  <!--GetNychaAwardMethods-->
  <statement name="GetContractsByAwardMethods" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int"/>
    <sql>
      SELECT award_method_id,
        award_method_name,
        SUM(purchase_order_count) AS purchase_order_count,
        SUM(total_amount) AS total_amount,
        SUM(original_amount) AS original_amount,
        SUM(spend_to_date) AS spend_to_date
      FROM contracts_fy_award_method_summary_vw
      <where>
        <exp op="AND">
          <exp op="=" dbField="fiscal_year_id" paramName="year" />
        </exp>
      </where>
      GROUP BY award_method_name, award_method_id
    </sql>
  </statement>
  <!--GetNychaPurchaseOrders-->
  <statement name="GetContractsByPurchaseOrders" datasource="checkbook_nycha">
  <param name="year" required ="true" type="int"/>
    <param name="vendor" type="int"/>
  <sql>
    SELECT po_number,
      purpose,
      vendor_name,
      SUM(total_amount) AS total_amount,
      SUM(original_amount) AS original_amount,
      SUM(spend_to_date) AS spend_to_date
    FROM  contracts_fy_po_vendor_summary_vw
    <where>
      <exp op="AND">
        <exp op="=" dbField="fiscal_year_id" paramName="year" />
        <exp op="=" dbField="vendor_id" paramName="vendor" />
      </exp>
    </where>
    GROUP BY po_number, purpose, vendor_name
  </sql>
</statement>
  <statement name="GetContractsByBoroughs" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int"/>
    <param name="vendor" type="int"/>
    <sql>
      SELECT
        location_borough_name,
        SUM(purchase_order_count) AS purchase_order_count,
        SUM(total_amount) AS total_amount,
        SUM(original_amount) AS original_amount,
        SUM(spend_to_date) AS spend_to_date
      FROM contracts_fy_borough_summary_vw
      <where>
        <exp op="AND">
          <exp op="=" dbField="fiscal_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
        </exp>
      </where>
      GROUP BY location_borough_name
    </sql>
  </statement>
  <!--GetNychaBlanketAgreements-->
  <statement name="GetContractsBlanketAgreements" datasource="checkbook_nycha">
    <param name="year" required ="true" type="yearfix"/>
    <param name="vendor" type="int"/>
    <sql>
      SELECT po_number,
        contract_agreement_uniq_id,
        purpose,
        vendor_name,
        SUM(total_amount) AS total_amount,
        SUM(original_amount) AS original_amount,
        SUM(spend_to_date) AS spend_to_date
      FROM contract_agreements_fy_vendor
      <where>
        <exp op="AND">
          <!--WHERE  '2016' BETWEEN FY_Start AND FY_End-->
          <exp op="BETWEEN" paramName="year" dbField="FY_Start,FY_End" />
          <exp op="=" dbField="transaction_category_code">'BA'</exp>
          <exp op="=" dbField="vendor_id" paramName="vendor" />
        </exp>
      </where>
      GROUP BY po_number, contract_agreement_uniq_id, purpose, vendor_name
    </sql>
  </statement>
  <!--GetBlanketAgreementModifications-->
  <statement name="GetContractsBlanketAgreementModifications" datasource="checkbook_nycha">
    <param name="year" required ="true" type="yearfix"/>
    <param name="vendor" type="int"/>
    <sql>
      SELECT po_number,
        contract_agreement_uniq_id,
        purpose,
        vendor_name,
        SUM(total_amount) AS total_amount,
        SUM(original_amount) AS original_amount,
        SUM(spend_to_date) AS spend_to_date,
        SUM(dollar_difference) AS dollar_difference,
        AVG(percent_difference) AS percent_difference
      FROM contract_agreements_fy_vendor
      <where>
        <exp op="AND">
          <!--WHERE  '2016' BETWEEN FY_Start AND FY_End-->
          <exp op="BETWEEN" paramName="year" dbField="FY_Start,FY_End" />
          <exp op="=" dbField="transaction_category_code">'BA'</exp>
          <exp op="=" dbField="vendor_id" paramName="vendor" />
        </exp>
      </where>
      GROUP BY  po_number, contract_agreement_uniq_id, purpose, vendor_name
    </sql>
  </statement>
  <!--GetGrants-->
  <statement name="GetContractsByGrants" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int"/>
    <param name="vendor" type="int"/>
    <sql>
       SELECT grant_id,
              grant_name,
              SUM(purchase_order_count) AS purchase_order_count,
              SUM(total_amount) AS total_amount,
              SUM(original_amount) AS original_amount,
              SUM(spend_to_date) AS spend_to_date
      FROM contracts_fy_grant_summary_vw
      <where>
        <exp op="AND">
          <exp op="=" dbField="fiscal_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
        </exp>
      </where>
      GROUP BY grant_id, grant_name
    </sql>
  </statement>
  <!--GetNychaPlannedAgreements-->
  <statement name="GetContractsPlannedAgreements" datasource="checkbook_nycha">
    <param name="year" required ="true" type="yearfix"/>
    <param name="vendor" type="int"/>
    <sql>
      SELECT po_number,
             contract_agreement_uniq_id,
             purpose,
             vendor_name,
             SUM(total_amount) AS total_amount,
             SUM(original_amount) AS original_amount,
             SUM(spend_to_date) AS spend_to_date
      FROM contract_agreements_fy_vendor
      <where>
        <exp op="AND">
          <!--WHERE  '2016' BETWEEN FY_Start AND FY_End-->
          <exp op="BETWEEN" paramName="year" dbField="FY_Start,FY_End" />
          <exp op="=" dbField="transaction_category_code">'PA'</exp>
          <exp op="=" dbField="vendor_id" paramName="vendor" />
        </exp>
      </where>
      GROUP BY po_number, contract_agreement_uniq_id, purpose, vendor_name
    </sql>
  </statement>
  <!--GetPlannedAgreementModifications-->
  <statement name="GetContractsPlannedAgreementModifications" datasource="checkbook_nycha">
    <param name="year" required ="true" type="yearfix"/>
    <param name="vendor" type="int"/>
    <sql>
      SELECT po_number,
              contract_agreement_uniq_id,
              purpose,
              vendor_name,
              SUM(total_amount) AS total_amount,
              SUM(original_amount) AS original_amount,
              SUM(spend_to_date) AS spend_to_date,
              SUM(dollar_difference) AS dollar_difference,
              AVG(percent_difference) AS percent_difference
      FROM contract_agreements_fy_vendor
      <where>
        <exp op="AND">
          <!--WHERE  '2016' BETWEEN FY_Start AND FY_End-->
          <exp op="BETWEEN" paramName="year" dbField="FY_Start,FY_End" />
          <exp op="=" dbField="transaction_category_code">'PA'</exp>
          <exp op="=" dbField="vendor_id" paramName="vendor" />
        </exp>
      </where>
      GROUP BY po_number, contract_agreement_uniq_id, purpose, vendor_name
    </sql>
  </statement>
  <!--GetDepartment-->
  <statement name="GetContractsByDepartments" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int"/>
    <sql>
      SELECT department_id,
             department_name,
             SUM(purchase_order_count) AS purchase_order_count,
             SUM(total_amount) AS total_amount,
             SUM(original_amount) AS original_amount,
             SUM(spend_to_date) AS spend_to_date
      FROM  contracts_fy_department_summary_vw
      <where>
        <exp op="AND">
          <exp op="=" dbField="fiscal_year_id" paramName="year" />
        </exp>
      </where>
      GROUP BY department_id, department_name
    </sql>
  </statement>
  <statement name="GetContractsByIndustries" datasource="checkbook">
    <param name="year" required ="true" type="int"/>
    <param name="vendor" type="int"/>
    <sql>
      SELECT fiscal_year,
        fiscal_year_id,
        transaction_category_code,
        industry_type_code,
        industry_type_name,
        industry_type_id,
        purchase_order_count,
        total_amount,
        original_amount
      FROM contracts_fy_industry_summary_vw
      <where>
        <exp op="AND">
          <exp op="=" dbField="fiscal_year_id" paramName="year" />
          <exp op="=" dbField="vendor_id" paramName="vendor" />
        </exp>
      </where>
      GROUP BY industry_type_id,industry_type_name
    </sql>
  </statement>
</statements>
