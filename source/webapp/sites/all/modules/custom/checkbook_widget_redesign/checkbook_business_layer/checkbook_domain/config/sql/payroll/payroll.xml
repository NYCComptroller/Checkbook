
<statements>
    <statement name="GetAgenciesByPayroll" datasource="checkbook">
        <param name="year" required ="true" type="int" />
        <sql>
            SELECT
            agency_name,
            agency_short_name,
            agg_agency.agency_id AS agency,
            SUM(agg_agency.overtime_pay) AS total_overtime_pay,
            SUM(agg_agency.gross_pay) AS total_gross_pay,
            SUM( CASE WHEN agg_agency.type_of_employment = 'Salaried' THEN COALESCE(agg_agency.annual_salary, 0) else NULL END) AS total_employees,
            COUNT(DISTINCT (CASE WHEN agg_agency.type_of_employment = 'Salaried' THEN agg_agency.employee_number END)) AS total_salaried_employees,
            SUM( CASE WHEN agg_agency.type_of_employment = 'Salaried' THEN NULL else COALESCE(agg_agency.annual_salary,0) END) AS total_non_salaried_employees,
            agg_agency.type_of_year AS year_type,
            agg_agency.fiscal_year_id AS year,
            SUM(agg_agency.other_payments) AS total_other_payments
            FROM aggregateon_payroll_employee_agency agg_agency
            JOIN ref_agency
            ON ref_agency.agency_id = agg_agency.agency_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="agg_agency.fiscal_year_id" paramName="year" />
                </exp>
            </where>
            GROUP BY agg_agency.agency_id,
            agg_agency.fiscal_year_id,
            agg_agency.type_of_year,
            agency_name,
            agency_short_name
        </sql>
    </statement>
    <statement name="GetAgenciesByOvertime" datasource="checkbook">
        <param name="year" required ="true" type="int" />
        <sql>
            SELECT
            ref_agency.agency_short_name AS agency_short,
            ref_agency.agency_name AS agency_name,
            agg.agency_id AS agency,
            SUM(agg.gross_pay) AS total_gross_pay,
            <!--COUNT(DISTINCT (CASE WHEN COALESCE(agg.positive_overtime_pay,0) > 0 THEN agg.employee_number END)) AS total_overtime_employees,-->
            123 as total_overtime_employees,
            <!--SUM(agg.overtime_pay) AS total_overtime_pay,-->
            456 as total_overtime_pay,
            agg.type_of_year AS year_type,
            agg.fiscal_year_id AS year
            FROM ref_agency
            JOIN aggregateon_payroll_employee_agency agg
            ON ref_agency.agency_id = agg.agency_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="agg.fiscal_year_id" paramName="year" />
                </exp>
            </where>
            GROUP BY agg.agency_id,
            agg.fiscal_year_id,
            agg.type_of_year,
            ref_agency.agency_short_name,
            ref_agency.agency_name
        </sql>
    </statement>
    <statement name="GetAnnualSalaries" datasource="checkbook">
        <param name="year" required ="true" type="int" />
        <param name="agency" type="int" />
        <param name="title" type="int" />
        <param name="type_of_employment" type="string" />
        <sql>
            SELECT agg.employee_id,
            ref.agency_name,
            agg.agency_id,
            ref.agency_short_name,
            agg.employee_number,
            agg.civil_service_title,
            agg.civil_service_title_code,
            MAX(agg.annual_salary) AS max_annual_salary,
            SUM(agg.gross_pay) AS total_gross_pay,
            SUM(agg.base_pay) AS total_base_salary,
            SUM(agg.other_payments) AS total_other_payments,
            SUM(agg.overtime_pay) AS total_overtime_amount,
            agg.type_of_year,
            agg.fiscal_year_id,
            agg.type_of_employment
            FROM aggregateon_payroll_latest_employee_agency agg
            JOIN ref_agency ref
            ON ref.agency_id = agg.agency_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="agg.type_of_employment" paramName="type_of_employment" />
                    <exp op="=" dbField="agg.fiscal_year_id" paramName="year" />
                </exp>
            </where>
            GROUP BY agg.agency_id,
            agg.employee_id,
            agg.type_of_employment,
            agg.fiscal_year_id,
            agg.type_of_year,
            agg.civil_service_title,
            agg.civil_service_title_code,
            agg.employee_number,
            ref.agency_name,
            ref.agency_short_name
        </sql>
    </statement>
    <statement name="GetAnnualSalariesPerAgency" datasource="checkbook"></statement>
    <statement name="GetTitlesByNumberOfEmployees" datasource="checkbook"></statement>
</statements>
