<statements>

  <!--Expense Categories Methods-->
  <statement name="GetNychaExpenseCategoriesByBudget" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="respcenter" type="string" />
    <param name="fundsrc" type="string" />
    <param name="program" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      expenditure_type_description AS expense_category,
      expenditure_type_id,
      SUM(adopted_budget) AS adopted_budget,
      SUM(modified_budget) AS modified_budget,
      SUM(funds_available)AS funds_available,
      SUM(committed)AS committed
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="program_phase_id" paramName="program" />
          <exp op="=" dbField="gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY expenditure_type_description,expenditure_type_id
    </sql>
  </statement>

  <statement name="GetNychaExpenseCategoriesByCommittedExpenseBudget" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="respcenter" type="string" />
    <param name="fundsrc" type="string" />
    <param name="program" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      expenditure_type_description AS expense_category,
      expenditure_type_id,
      SUM(committed) AS committed,
      SUM(encumbrance_amount) AS encumbrance_amount,
      SUM(actual_amount) AS actual_amount
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="program_phase_id" paramName="program" />
          <exp op="=" dbField="gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY expenditure_type_description, expenditure_type_id
    </sql>
  </statement>

  <statement name="GetNychaExpenseCategoriesByPercentDifference" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="respcenter" type="string" />
    <param name="fundsrc" type="string" />
    <param name="program" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      a.budget_fiscal_year,
      SUM(COALESCE(a.modified_budget_amount,0)) AS current_amount,
      SUM(COALESCE(a.modified_budget_amount_py_1,0)) AS previous_amount,
      SUM(COALESCE(a.modified_budget_amount_py_2,0)) AS previous_1_amount,
      a.expenditure_type_name,
      b.expenditure_type_description AS expense_category,
      b.expenditure_type_id,
      CASE SUM(COALESCE(modified_budget_amount_py_1,0)) WHEN 0 THEN 0 ELSE ((SUM(COALESCE(modified_budget_amount,0)) - SUM(COALESCE(modified_budget_amount_py_1,0)))/SUM(COALESCE(modified_budget_amount_py_1,0)))*100 END AS percent_difference3
      FROM aggregateon_budget_by_year a
      JOIN budget b
      ON a.expenditure_type_name = b.expenditure_type_name
      <where>
        <exp op="AND">
          <exp op="=" dbField="b.budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="b.responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="b.funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="b.program_phase_id" paramName="program" />
          <exp op="=" dbField="b.gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY a.budget_fiscal_year, a.expenditure_type_name, b.expenditure_type_description, b.expenditure_type_id
    </sql>
  </statement>

  <statement name="GetResponsibilityCenters" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="fundsrc" type="string" />
    <param name="program" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      responsibility_center_description AS responsibility_center,
      responsibility_center_id,
      SUM(adopted_budget) AS adopted_budget,
      SUM(modified_budget) AS modified_budget,
      SUM(committed) AS committed,
      SUM(funds_available) AS funds_available
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="program_phase_id" paramName="program" />
          <exp op="=" dbField="gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY responsibility_center_description, responsibility_center_id
    </sql>
  </statement>

  <statement name="GetResponsibilityCentersByCommittedExpense" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="fundsrc" type="string" />
    <param name="program" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      responsibility_center_description AS responsibility_center,
      responsibility_center_id,
      SUM(committed) AS committed,
      SUM(encumbrance_amount) AS encumbrance_amount,
      SUM(actual_amount) AS actual_amount
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="program_phase_id" paramName="program" />
          <exp op="=" dbField="gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY responsibility_center_description, responsibility_center_id
    </sql>
  </statement>

  <statement name="GetNychaResponsibilityCentersByPercentDifference" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="fundsrc" type="string" />
    <param name="program" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      a.budget_fiscal_year,
      SUM(COALESCE(a.modified_budget_amount,0)) AS current_amount,
      SUM(COALESCE(a.modified_budget_amount_py_1,0)) AS previous_amount,
      a.responsibility_center_code,
      b.responsibility_center_description AS responsibility_center,
      b.responsibility_center_id,
      CASE SUM(COALESCE(modified_budget_amount_py_1,0)) WHEN 0 THEN 0 ELSE ((SUM(COALESCE(modified_budget_amount,0)) - SUM(COALESCE(modified_budget_amount_py_1,0)))/SUM(COALESCE(modified_budget_amount_py_1,0)))*100 END AS percent_difference3
      FROM aggregateon_budget_by_year a
      JOIN budget b
      ON a.responsibility_center_code = b.responsibility_center_code
      <where>
        <exp op="AND">
          <exp op="=" dbField="b.budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="b.expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="b.funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="b.program_phase_id" paramName="program" />
          <exp op="=" dbField="b.gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY a.budget_fiscal_year, a.responsibility_center_code, b.responsibility_center_description, b.responsibility_center_id
    </sql>
  </statement>

  <statement name="GetFundingSources" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="respcenter" type="string" />
    <param name="program" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      funding_source_description AS funding_source_description,
      funding_source_id,
      SUM(adopted_budget) AS adopted_budget,
      SUM(modified_budget) AS modified_budget,
      SUM(committed) AS committed,
      SUM(funds_available) AS funds_available
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="program_phase_id" paramName="program" />
          <exp op="=" dbField="gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY funding_source_description, funding_source_id
    </sql>
  </statement>

  <statement name="GetFundingSourcesByCommittedExpense" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="respcenter" type="string" />
    <param name="program" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      funding_source_description AS funding_source_description,
      funding_source_id,
      SUM(committed) AS committed,
      SUM(encumbrance_amount) AS encumbrance_amount,
      SUM(actual_amount) AS actual_amount
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="program_phase_id" paramName="program" />
          <exp op="=" dbField="gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY funding_source_description, funding_source_id
    </sql>
  </statement>

  <statement name="GetNychaFundingSourcesByPercentDifference" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="respcenter" type="string" />
    <param name="program" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      a.budget_fiscal_year,
      SUM(COALESCE(a.modified_budget_amount,0)) AS current_amount,
      SUM(COALESCE(a.modified_budget_amount_py_1,0)) AS previous_amount,
      a.funding_source_code,
      b.funding_source_description AS funding_source_description,
      b.funding_source_id,
      CASE SUM(COALESCE(modified_budget_amount_py_1,0)) WHEN 0 THEN 0 ELSE ((SUM(COALESCE(modified_budget_amount,0)) - SUM(COALESCE(modified_budget_amount_py_1,0)))/SUM(COALESCE(modified_budget_amount_py_1,0)))*100 END AS percent_difference3
      FROM aggregateon_budget_by_year a
      JOIN budget b
      ON a.funding_source_code = b.funding_source_code
      <where>
        <exp op="AND">
          <exp op="=" dbField="b.budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="b.expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="b.responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="b.program_phase_id" paramName="program" />
          <exp op="=" dbField="b.gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY a.budget_fiscal_year, a.funding_source_code, b.funding_source_description, b.funding_source_id
    </sql>
  </statement>

  <statement name="GetPrograms" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="respcenter" type="string" />
    <param name="fundsrc" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      program_phase_description AS program_phase_description,
      program_phase_id,
      SUM(adopted_budget) AS adopted_budget,
      SUM(modified_budget) AS modified_budget,
      SUM(committed) AS committed,
      SUM(funds_available) AS funds_available
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="expcategory" />
          <exp op="=" dbField="expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY program_phase_description, program_phase_id
    </sql>
  </statement>

  <statement name="GetProgramsByCommittedExpense" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="respcenter" type="string" />
    <param name="fundsrc" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      program_phase_description AS program_phase_description,
      program_phase_id,
      SUM(committed) AS committed,
      SUM(encumbrance_amount) AS encumbrance_amount,
      SUM(actual_amount) AS actual_amount
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY program_phase_description, program_phase_id
    </sql>
  </statement>

  <statement name="GetNychaProgramsByPercentDifference" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="respcenter" type="string" />
    <param name="fundsrc" type="string" />
    <param name="project" type="string" />
    <sql>
      SELECT
      a.budget_fiscal_year,
      SUM(COALESCE(a.modified_budget_amount,0)) AS current_amount,
      SUM(COALESCE(a.modified_budget_amount_py_1,0)) AS previous_amount,
      a.program_phase_code,
      b.program_phase_description AS program_phase_description,
      b.program_phase_id,
      CASE SUM(COALESCE(modified_budget_amount_py_1,0)) WHEN 0 THEN 0 ELSE ((SUM(COALESCE(modified_budget_amount,0)) - SUM(COALESCE(modified_budget_amount_py_1,0)))/SUM(COALESCE(modified_budget_amount_py_1,0)))*100 END AS percent_difference3
      FROM aggregateon_budget_by_year a
      JOIN budget b
      ON a.program_phase_code = b.program_phase_code
      <where>
        <exp op="AND">
          <exp op="=" dbField="b.budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="b.expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="b.responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="b.funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="b.gl_project_id" paramName="project" />
        </exp>
      </where>
      GROUP BY a.budget_fiscal_year, a.program_phase_code, b.program_phase_description, b.program_phase_id
    </sql>
  </statement>

  <statement name="GetProjects" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="respcenter" type="string" />
    <param name="fundsrc" type="string" />
    <param name="program" type="string" />
    <sql>
      SELECT
      gl_project_description AS gl_project_description,
      gl_project_id,
      SUM(adopted_budget) AS adopted_budget,
      SUM(modified_budget) AS modified_budget,
      SUM(committed) AS committed,
      SUM(funds_available) AS funds_available
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="program_phase_id" paramName="program" />
        </exp>
      </where>
      GROUP BY gl_project_description, gl_project_id
    </sql>
  </statement>

  <statement name="GetProjectsByCommittedExpense" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="respcenter" type="string" />
    <param name="fundsrc" type="string" />
    <param name="program" type="string" />
    <sql>
      SELECT
      gl_project_description AS gl_project_description,
      gl_project_id,
      SUM(committed) AS committed,
      SUM(encumbrance_amount) AS encumbrance_amount,
      SUM(actual_amount) AS actual_amount
      FROM budget
      <where>
        <exp op="AND">
          <exp op="=" dbField="budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="program_phase_id" paramName="program" />
        </exp>
      </where>
      GROUP BY gl_project_description, gl_project_id
    </sql>
  </statement>

  <statement name="GetProjectsByPercentDifference" datasource="checkbook_nycha">
    <param name="year" required ="true" type="int" />
    <param name="expcategory" type="string" />
    <param name="respcenter" type="string" />
    <param name="fundsrc" type="string" />
    <param name="program" type="string" />
    <sql>
      SELECT
      a.budget_fiscal_year,
      SUM(COALESCE(a.modified_budget_amount,0)) AS current_amount,
      SUM(COALESCE(a.modified_budget_amount_py_1,0)) AS previous_amount,
      a.gl_project_code,
      b.gl_project_description AS gl_project_description,
      b.gl_project_id,
      CASE SUM(COALESCE(modified_budget_amount_py_1,0)) WHEN 0 THEN 0 ELSE ((SUM(COALESCE(modified_budget_amount,0)) - SUM(COALESCE(modified_budget_amount_py_1,0)))/SUM(COALESCE(modified_budget_amount_py_1,0)))*100 END AS percent_difference3
      FROM aggregateon_budget_by_year a
      JOIN budget b
      ON a.gl_project_code = b.gl_project_code
      <where>
        <exp op="AND">
          <exp op="=" dbField="b.budget_fiscal_year_id" paramName="year" />
          <exp op="=" dbField="b.expenditure_type_id" paramName="expcategory" />
          <exp op="=" dbField="b.responsibility_center_id" paramName="respcenter" />
          <exp op="=" dbField="b.funding_source_id" paramName="fundsrc" />
          <exp op="=" dbField="b.program_phase_id" paramName="program" />
        </exp>
      </where>
      GROUP BY a.budget_fiscal_year, a.gl_project_code, b.gl_project_description, b.gl_project_id
    </sql>
  </statement>

</statements>


