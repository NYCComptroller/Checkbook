<statements>
    <!--GetContracts,GetCountContracts-->
    <statement name="GetContracts" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <sql>
            SELECT
            l1.contract_number,
            l1.description as contract_purpose,
            l3.agency_id,
            l3.agency_name,
            l4.vendor_id,
            l4.legal_name as vendor_name,
            l1.minority_type_id,
            l1.original_agreement_id,
            l1.document_code_id,
            l2.document_code,
            CASE
            WHEN l1.scntrc_status = 1 THEN 'No Data Entered'
            WHEN l1.scntrc_status = 2 THEN 'Yes'
            WHEN l1.scntrc_status = 3 THEN 'No'
            ELSE 'N/A'
            END AS contract_subvendor_status,
            SUM(COALESCE(l1.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(l1.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(l1.spending_amount,0)) AS spending_amount_sum
            FROM aggregateon_mwbe_contracts_cumulative_spending l1
            JOIN ref_document_code l2 ON l2.document_code_id = l1.document_code_id
            JOIN ref_agency l3 on l3.agency_id = l1.agency_id
            JOIN vendor l4 on l4.vendor_id = l1.vendor_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="l1.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="l1.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="l1.status_flag" paramName="status" />
                    <exp op="IN" dbField="l2.document_code" paramName="doctype" />
                    <exp op="=" dbField="l1.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="l1.agency_id" paramName="agency" />
                    <exp op="IN" dbField="l1.minority_type_id" paramName="mwbe" />
                </exp>
            </where>
            GROUP BY l1.type_of_year, l1.description,l1.contract_number, l1.original_agreement_id, l1.document_code_id,l2.document_code, l1.minority_type_id,l3.agency_id,l3.agency_name,l4.vendor_id,l4.legal_name,l1.scntrc_status
        </sql>
    </statement>
    <statement name="GetCountContracts" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <sql>
            SELECT COUNT(*) as record_count FROM
            (
            SELECT l1.contract_number
            FROM aggregateon_mwbe_contracts_cumulative_spending l1
            JOIN ref_document_code l2 ON l2.document_code_id = l1.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="l1.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="l1.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="l1.status_flag" paramName="status" />
                    <exp op="IN" dbField="l2.document_code" paramName="doctype" />
                    <exp op="=" dbField="l1.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="l1.agency_id" paramName="agency" />
                    <exp op="IN" dbField="l1.minority_type_id" paramName="mwbe" />
                </exp>
            </where>
            ) sub_query
        </sql>
    </statement>
    <!--GetOgeContracts,GetCoutOgeContracts-->
    <statement name="GetOgeContracts" datasource="checkbook_oge">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT
            a.type_of_year,
            c.agency_id,
            c.agency_name as agency_name,
            d.vendor_id,
            d.legal_name as vendor_name,
            a.description AS contract_purpose,
            a.contract_number,
            a.original_agreement_id,
            a.document_code_id,
            b.document_code,
            'TBD' contract_subvendor_status,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            SUM(COALESCE(dollar_difference,0)) AS dollar_difference,
            AVG(percent_difference) AS percent_difference
            FROM aggregateon_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
            GROUP BY a.type_of_year, a.description,a.contract_number, a.original_agreement_id, a.document_code_id,b.document_code,c.agency_id,c.agency_name,d.vendor_id,d.legal_name
        </sql>
    </statement>
    <statement name="GetCountOgeContracts" datasource="checkbook_oge">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT COUNT(*) as record_count FROM
            (
            SELECT a.contract_number
            FROM aggregateon_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
            GROUP BY a.contract_number
            ) sub_query
        </sql>
    </statement>
    <!--GetPrimeVendors,GetCountPrimeVendors-->
    <statement name="GetPrimeVendors" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            d.vendor_id,
            d.legal_name as vendor_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                </exp>
            </where>
            GROUP BY a.type_of_year,d.vendor_id,d.legal_name
        </sql>
    </statement>
    <statement name="GetCountPrimeVendors" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT COUNT(DISTINCT a.vendor_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
        </sql>
    </statement>
    <!--GetAwardMethods,GetCountAwardMethods-->
    <statement name="GetAwardMethods" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            e.award_method_id,
            e.award_method_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            JOIN ref_award_method e ON e.award_method_id = a.award_method_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                </exp>
            </where>
            GROUP BY a.type_of_year,e.award_method_id,e.award_method_name
        </sql>
    </statement>
    <statement name="GetCountAwardMethods" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT COUNT(DISTINCT a.award_method_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
        </sql>
    </statement>
    <!--GetAgencies,GetCountAgencies-->
    <statement name="GetAgencies" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            e.agency_id,
            e.agency_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            JOIN ref_agency e ON e.agency_id = a.agency_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                </exp>
            </where>
            GROUP BY a.type_of_year,e.agency_id,e.agency_name
        </sql>
    </statement>
    <statement name="GetCountAgencies" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT COUNT(DISTINCT a.agency_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
        </sql>
    </statement>
    <!--GetContractsByIndustries,GetCountContractsByIndustries-->
    <statement name="GetContractsByIndustries" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="cindustry" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            e.industry_type_id,
            e.industry_type_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            JOIN ref_industry_type e ON e.industry_type_id = a.industry_type_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="e.industry_type_id" paramName="cindustry" />
                </exp>
            </where>
            GROUP BY a.type_of_year,e.industry_type_id,e.industry_type_name
        </sql>
    </statement>
    <statement name="GetCountContractsByIndustries" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="cindustry" type="int" />
        <sql>
            SELECT count(a.document_code_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="=" dbField="a.industry_type_id" paramName="cindustry" />
                </exp>
            </where>
        </sql>
    </statement>
    <!--GetContractsBySize,GetCountContractsBySize-->
    <statement name="GetContractsBySize" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="csize" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            e.award_size_id,
            e.award_size_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            JOIN ref_award_size e ON e.award_size_id = a.award_size_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="e.award_size_id" paramName="csize" />
                </exp>
            </where>
            GROUP BY a.type_of_year,e.award_size_id,e.award_size_name
        </sql>
    </statement>
    <statement name="GetCountContractsBySize" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="csize" type="int" />
        <sql>
            SELECT count(a.document_code_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="=" dbField="a.award_size_id" paramName="csize" />
                </exp>
            </where>
        </sql>
    </statement>
    <!--GetPrimeContractSubVenReporting,GetCountPrimeContractSubVenReporting-->
    <statement name="GetPrimeContractSubVenReporting" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <sql>
            SELECT
            l3.agency_id,
            l3.agency_name,
            COUNT(DISTINCT l1.contract_number) as number_contracts,
            SUM(COALESCE(l1.spending_amount,0)) AS spending_amount_sum,
            SUM(CASE WHEN l1.scntrc_status = 1 THEN 1 ELSE 0 END) AS no_response_status,
            SUM(CASE WHEN l1.scntrc_status = 2 THEN 1 ELSE 0 END) AS reported_sub_count,
            SUM(CASE WHEN l1.scntrc_status = 3 THEN 1 ELSE 0 END) AS reported_no_sub_count,
            SUM(CASE WHEN l1.scntrc_status = 2 AND sd.contract_number IS NULL THEN 1 ELSE 0 END) AS reported_no_details_count
            FROM aggregateon_mwbe_contracts_cumulative_spending l1
            LEFT JOIN
            (
                SELECT DISTINCT contract_number FROM subcontract_details
                <where>
                    <exp op="AND">
                        <exp op="=" dbField="latest_flag">'Y'</exp>
                    </exp>
                </where>
            ) sd ON l1.contract_number = sd.contract_number
            JOIN ref_document_code l2 ON l2.document_code_id = l1.document_code_id
            JOIN ref_agency l3 on l3.agency_id = l1.agency_id
            JOIN vendor l4 on l4.vendor_id = l1.vendor_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="l1.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="l1.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="l1.status_flag" paramName="status" />
                    <exp op="IN" dbField="l2.document_code" paramName="doctype" />
                    <exp op="=" dbField="l1.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="l1.agency_id" paramName="agency" />
                    <exp op="IN" dbField="l1.minority_type_id" paramName="mwbe" />
                </exp>
            </where>
            GROUP BY l3.agency_id, l3.agency_name
        </sql>
    </statement>
    <statement name="GetSubvendorContractsbyPrime" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT
            ra.agency_name AS agency_name,
            ra.agency_id,
            COUNT(DISTINCT a.contract_number ) AS reported_contracts_with_subvendors,
            COUNT(sd.aprv_sta) AS no_of_subvendors_submitted,
            SUM(CASE WHEN aprv_sta=3 THEN 1 ELSE 0 END) AS acco_reviewing,
            SUM(CASE WHEN aprv_sta=4 THEN 1 ELSE 0 END) AS acco_approved,
            SUM(CASE WHEN aprv_sta=2 THEN 1 ELSE 0 END) AS acco_rejected,
            SUM(CASE WHEN aprv_sta=5 THEN 1 ELSE 0 END) AS acco_cancelled
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            LEFT JOIN (SELECT contract_number, aprv_sta FROM subcontract_details WHERE latest_flag='Y') sd ON a.contract_number=sd.contract_number
            LEFT JOIN ref_document_code c ON a.document_code_id=c.document_code_id
            LEFT JOIN ref_agency ra ON a.agency_id=ra.agency_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="c.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="=" dbField="a.scntrc_status">2</exp>
                    <exp op="IN" dbField="a.minority_type_id" paramName="mwbe" />
                </exp>
            </where>
            GROUP BY ra.agency_name, ra.agency_id
        </sql>
    </statement>
    <statement name="GetCountOfSubvendorContractsbyPrime" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT
            COUNT(DISTINCT a.contract_number ) AS record_count
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            LEFT JOIN (SELECT contract_number, aprv_sta FROM subcontract_details WHERE latest_flag='Y') sd ON a.contract_number=sd.contract_number
            LEFT JOIN ref_document_code c ON a.document_code_id=c.document_code_id
            LEFT JOIN ref_agency ra ON a.agency_id=ra.agency_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="c.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="=" dbField="a.scntrc_status">2</exp>
                    <exp op="IN" dbField="a.minority_type_id" paramName="mwbe" />
                </exp>
            </where>
        </sql>
    </statement>
    <statement name="GetSubvendorStatusByPrimeContractID" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT
            a.original_agreement_id,
            a.agency_id,
            a.vendor_id,
            a.is_prime_or_sub,
            a.minority_type_id,
            rd.document_code,
            a.contract_number,
            a.description,
            a.agency_name,
            CASE WHEN a.vendor_name IS NULL THEN 'N/A' ELSE a.vendor_name END AS vendor_name,
            CASE WHEN b.vendor_name IS NULL THEN 'NOT PROVIDED' ELSE b.vendor_name END AS sub_vendor,
            c.aprv_sta_value as aprv_status_value
            FROM all_agreement_transactions a
            LEFT JOIN
            (
                SELECT a.original_agreement_id, a.contract_number, a.vendor_name,a.aprv_sta as aprv_sta_id
                FROM all_agreement_transactions a
                <where>
                    <exp op="AND">
                        <exp op="=" dbField="a.prime_vendor_id" paramName="vendor" />
                        <exp op="=" dbField="a.is_prime_or_sub">'S'</exp>
                        <exp op="=" dbField="a.latest_flag">'Y'</exp>
                        <exp op="=" dbField="a.scntrc_status">0</exp>
                    </exp>
                </where>
            ) b on b.contract_number = a.contract_number
            LEFT JOIN subcontract_approval_status c ON c.aprv_sta_id = COALESCE(b.aprv_sta_id,6)
            JOIN ref_document_code rd ON rd.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.prime_vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="IN" dbField="a.minority_type_id" paramName="mwbe" />
                    <exp op="=" dbField="a.is_prime_or_sub">'P'</exp>
                    <exp op="&lt;=" dbField="a.starting_year_id" paramName="year" />
                    <exp op="&gt;=" dbField="a.ending_year_id" paramName="year" />
                    <exp op="&lt;=" dbField="a.effective_begin_year_id" paramName="year" />
                    <exp op="&gt;=" dbField="a.effective_end_year_id" paramName="year" />
                    <exp op="=" dbField="a.latest_flag">'Y'</exp>
                    <exp op="=" dbField="a.scntrc_status">2</exp>
                    <exp op="IN" dbField="rd.document_code" paramName="doctype" />
                </exp>
            </where>
            ORDER BY c.sort_order,a.original_agreement_id
        </sql>
    </statement>
    <statement name="GetCountSubvendorStatusByPrimeContractID" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT COUNT(DISTINCT a.contract_number ) AS record_count
            FROM all_agreement_transactions a
            LEFT JOIN
            (
            SELECT a.original_agreement_id, a.contract_number, a.vendor_name,a.aprv_sta as aprv_sta_id
            FROM all_agreement_transactions a
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.prime_vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.is_prime_or_sub">'S'</exp>
                    <exp op="=" dbField="a.latest_flag">'Y'</exp>
                    <exp op="=" dbField="a.scntrc_status">0</exp>
                </exp>
            </where>
            ) b on b.contract_number = a.contract_number
            LEFT JOIN subcontract_approval_status c ON c.aprv_sta_id = COALESCE(b.aprv_sta_id,6)
            JOIN ref_document_code rd ON rd.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.prime_vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="IN" dbField="a.minority_type_id" paramName="mwbe" />
                    <exp op="=" dbField="a.is_prime_or_sub">'P'</exp>
                    <exp op="&lt;=" dbField="a.starting_year_id" paramName="year" />
                    <exp op="&gt;=" dbField="a.ending_year_id" paramName="year" />
                    <exp op="&lt;=" dbField="a.effective_begin_year_id" paramName="year" />
                    <exp op="&gt;=" dbField="a.effective_end_year_id" paramName="year" />
                    <exp op="=" dbField="a.latest_flag">'Y'</exp>
                    <exp op="=" dbField="a.scntrc_status">2</exp>
                    <exp op="IN" dbField="rd.document_code" paramName="doctype" />
                </exp>
            </where>
        </sql>
    </statement>
</statements>
