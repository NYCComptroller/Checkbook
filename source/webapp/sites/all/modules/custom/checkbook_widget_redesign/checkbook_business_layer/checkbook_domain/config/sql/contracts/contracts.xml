<statements>

    <!--GetContracts,GetCountContracts-->
    <statement name="GetContracts" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT
            a.type_of_year,
            c.agency_id,
            c.agency_name as agency_name,
            d.vendor_id,
            d.legal_name as vendor_name,
            a.description AS contract_purpose,
            a.contract_number,
            a.original_agreement_id,
            a.document_code_id,
            b.document_code,
            a.minority_type_id,
            CASE
                WHEN sd.scntrc_status = 2 THEN 'Yes'
                WHEN sd.scntrc_status = 3 THEN 'No'
                ELSE 'No action taken by Prime Vendor'
            END AS contract_subvendor_status,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            SUM(COALESCE(dollar_difference,0)) AS dollar_difference,
            AVG(percent_difference) AS percent_difference
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            LEFT JOIN
            (
                SELECT contract_number, scntrc_status FROM subcontract_status
            ) sd ON a.contract_number = sd.contract_number
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="IN" dbField="a.minority_type_id" paramName="mwbe" />
                </exp>
            </where>
            GROUP BY a.type_of_year, a.description,a.contract_number, a.original_agreement_id, a.document_code_id,b.document_code, a.minority_type_id,c.agency_id,c.agency_name,d.vendor_id,d.legal_name,sd.scntrc_status
            <exp op="IF" condition="=" paramName="contract_mod" compareValue="true">
                HAVING SUM(COALESCE(dollar_difference,0)) != 0
            </exp>
        </sql>
    </statement>
    <statement name="GetCountContracts" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT COUNT(*) as record_count FROM
            (
                SELECT a.contract_number
                FROM aggregateon_mwbe_contracts_cumulative_spending a
                JOIN ref_document_code b ON a.document_code_id = b.document_code_id
                <where>
                    <exp op="AND">
                        <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                        <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                        <exp op="=" dbField="a.status_flag" paramName="status" />
                        <exp op="IN" dbField="b.document_code" paramName="doctype" />
                        <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                        <exp op="=" dbField="a.agency_id" paramName="agency" />
                        <exp op="IN" dbField="a.minority_type_id" paramName="mwbe" />
                    </exp>
                </where>
                GROUP BY a.contract_number
                <exp op="IF" condition="=" paramName="contract_mod" compareValue="true">
                    HAVING SUM(COALESCE(dollar_difference,0)) != 0
                </exp>
            ) sub_query
        </sql>
    </statement>
    <!--GetOgeContracts,GetCountOgeContracts-->
    <statement name="GetOgeContracts" datasource="checkbook_oge">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT
            a.type_of_year,
            c.agency_id,
            c.agency_name as agency_name,
            d.vendor_id,
            d.legal_name as vendor_name,
            a.description AS contract_purpose,
            a.contract_number,
            a.original_agreement_id,
            a.document_code_id,
            b.document_code,
            'TBD' contract_subvendor_status,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            SUM(COALESCE(dollar_difference,0)) AS dollar_difference,
            AVG(percent_difference) AS percent_difference
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            LEFT JOIN
            (
            SELECT contract_number, scntrc_status FROM subcontract_status
            ) sd ON a.contract_number = sd.contract_number
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
            GROUP BY a.type_of_year, a.description,a.contract_number, a.original_agreement_id, a.document_code_id,b.document_code,c.agency_id,c.agency_name,d.vendor_id,d.legal_name
            <exp op="IF" condition="=" paramName="contract_mod" compareValue="true">
                HAVING SUM(COALESCE(dollar_difference,0)) != 0
            </exp>
        </sql>
    </statement>
    <statement name="GetCountOgeContracts" datasource="checkbook_oge">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT COUNT(*) as record_count FROM
            (
            SELECT a.contract_number
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
            GROUP BY a.contract_number
            <exp op="IF" condition="=" paramName="contract_mod" compareValue="true">
                HAVING SUM(COALESCE(dollar_difference,0)) != 0
            </exp>
            ) sub_query
        </sql>
    </statement>
    <!--GetPrimeVendors,GetCountPrimeVendors-->
    <statement name="GetPrimeVendors" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            d.vendor_id,
            d.legal_name as vendor_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                </exp>
            </where>
            GROUP BY a.type_of_year,d.vendor_id,d.legal_name
        </sql>
    </statement>
    <statement name="GetCountPrimeVendors" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT COUNT(DISTINCT a.vendor_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
        </sql>
    </statement>
    <!--GetAwardMethods,GetCountAwardMethods-->
    <statement name="GetAwardMethods" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            e.award_method_id,
            e.award_method_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            JOIN ref_award_method e ON e.award_method_id = a.award_method_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                </exp>
            </where>
            GROUP BY a.type_of_year,e.award_method_id,e.award_method_name
        </sql>
    </statement>
    <statement name="GetCountAwardMethods" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT COUNT(DISTINCT a.award_method_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
        </sql>
    </statement>
    <!--GetAgencies,GetCountAgencies-->
    <statement name="GetAgencies" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            e.agency_id,
            e.agency_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            JOIN ref_agency e ON e.agency_id = a.agency_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                </exp>
            </where>
            GROUP BY a.type_of_year,e.agency_id,e.agency_name
        </sql>
    </statement>
    <statement name="GetCountAgencies" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <sql>
            SELECT COUNT(DISTINCT a.agency_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                </exp>
            </where>
        </sql>
    </statement>
    <!--GetContractsByIndustries,GetCountContractsByIndustries-->
    <statement name="GetContractsByIndustries" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="cindustry" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            e.industry_type_id,
            e.industry_type_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            JOIN ref_industry_type e ON e.industry_type_id = a.industry_type_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="e.industry_type_id" paramName="cindustry" />
                </exp>
            </where>
            GROUP BY a.type_of_year,e.industry_type_id,e.industry_type_name
        </sql>
    </statement>
    <statement name="GetCountContractsByIndustries" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="cindustry" type="int" />
        <sql>
            SELECT count(a.document_code_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="=" dbField="a.industry_type_id" paramName="cindustry" />
                </exp>
            </where>
        </sql>
    </statement>
    <!--GetContractsBySize,GetCountContractsBySize-->
    <statement name="GetContractsBySize" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="doctype" />
        <param name="status" type="string"/>
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="csize" type="int" />
        <sql>
            SELECT
            a.type_of_year,
            e.award_size_id,
            e.award_size_name,
            SUM(COALESCE(a.original_contract_amount,0)) AS original_amount_sum,
            SUM(COALESCE(a.maximum_contract_amount,0)) AS current_amount_sum,
            SUM(COALESCE(a.spending_amount,0)) AS spending_amount_sum,
            COUNT(contract_number) AS total_contracts
            FROM aggregateon_mwbe_contracts_cumulative_spending a
            JOIN ref_document_code b ON a.document_code_id = b.document_code_id
            JOIN ref_agency c on c.agency_id = a.agency_id
            JOIN vendor d on d.vendor_id = a.vendor_id
            JOIN ref_award_size e ON e.award_size_id = a.award_size_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="c.agency_id" paramName="agency" />
                    <exp op="=" dbField="d.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="e.award_size_id" paramName="csize" />
                </exp>
            </where>
            GROUP BY a.type_of_year,e.award_size_id,e.award_size_name
        </sql>
    </statement>
    <statement name="GetCountContractsBySize" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="csize" type="int" />
        <sql>
            SELECT count(a.document_code_id) as record_count
            FROM aggregateon_contracts_cumulative_spending a
            LEFT OUTER JOIN ref_document_code b ON b.document_code_id = a.document_code_id
            <where>
                <exp op="AND">
                    <exp op="=" dbField="a.fiscal_year_id" paramName="year" />
                    <exp op="=" dbField="a.type_of_year" paramName="yeartype" />
                    <exp op="=" dbField="a.status_flag" paramName="status" />
                    <exp op="IN" dbField="b.document_code" paramName="doctype" />
                    <exp op="=" dbField="a.vendor_id" paramName="vendor" />
                    <exp op="=" dbField="a.agency_id" paramName="agency" />
                    <exp op="=" dbField="a.award_size_id" paramName="csize" />
                </exp>
            </where>
        </sql>
    </statement>

    <!--GetPrimeContractSubVenReporting,GetCountPrimeContractSubVenReporting-->
    <statement name="GetPrimeContractSubVenReporting" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT
            'agency_id' AS agency_id,
            'agency_name' AS agency_name,
            'number_contracts' AS number_contracts,
            'spending_amount_sum' AS spending_amount_sum,
            'no_response_status' AS no_response_status,
            'reported_sub_count' AS reported_sub_count,
            'reported_no_sub_count' AS reported_no_sub_count,
            'reported_no_details_count' AS reported_no_details_count
        </sql>
    </statement>
    <statement name="GetCountPrimeContractSubVenReporting" datasource="checkbook">
        <param name="year" required ="true" type="int"/>
        <param name="yeartype" required ="true" type="string" />
        <param name="status" type="string"/>
        <param name="doctype" />
        <param name="agency" type="int" />
        <param name="vendor" type="int" />
        <param name="mwbe" />
        <param name="contract_mod" type="bool" />
        <sql>
            SELECT COUNT(*) as record_count FROM
            (
                SELECT 'agency_id' AS agency_id,
                'agency_name' AS agency_name,
                'number_contracts' AS number_contracts,
                'spending_amount_sum' AS spending_amount_sum,
                'no_response_status' AS no_response_status,
                'reported_sub_count' AS reported_sub_count,
                'reported_no_sub_count' AS reported_no_sub_count,
                'reported_no_details_count' AS reported_no_details_count
            ) sub_query
        </sql>
    </statement>
</statements>