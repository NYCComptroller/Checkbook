/*
 * File:        KeyTable.min.js
 * Version:     1.1.7
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * 
 * Copyright 2009-2011 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD (3 point) style license, as supplied with this software.
 * 
 * This source file is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 */
function KeyTable(E){function F(a){return function(c,b,d){(null===c||"number"==typeof c)&&(null===b||"number"==typeof b)&&"function"==typeof d?i[a].push({x:c,y:b,fn:d}):"object"==typeof c&&"function"==typeof b?(c=y(c),i[a].push({x:c[0],y:c[1],fn:b})):alert("Unhandable event type was added: x"+c+"  y:"+b+"  z:"+d)}}function G(a){return function(c,b,d){(null===c||"number"==typeof c)&&(null===b||"number"==typeof b)?"function"==typeof d?u(a,c,b,d):u(a,c,b):"object"==typeof c?(c=y(c),"function"==typeof b?
u(a,c[0],c[1],b):u(a,c[0],c[1])):alert("Unhandable event type was removed: x"+c+"  y:"+b+"  z:"+d)}}function u(a,c,b,d){for(var e=0,f=0,h=i[a].length;f<h-e;f++)if("undefined"!=typeof d)i[a][f-e].x==c&&i[a][f-e].y==b&&i[a][f-e].fn==d&&(i[a].splice(f-e,1),e++);else if(i[a][f-e].x==c&&i[a][f-e].y==b)return i[a].splice(f,1),1;return e}function v(a,c,b){for(var d=0,a=i[a],e=0;e<a.length;e++)if(a[e].x==c&&a[e].y==b||null===a[e].x&&a[e].y==b||a[e].x==c&&null===a[e].y||null===a[e].x&&null===a[e].y)a[e].fn(r(c,
b),c,b),d++;return d}function k(a,c){if(q!=a){"undefined"==typeof c&&(c=!0);null!==q&&z(q);jQuery(a).addClass(s);jQuery(a).parent().addClass(s);var b;if(j){b=j.fnSettings();for(var d=A(a)[1],e=m;d>=b.fnDisplayEnd();)0<=b._iDisplayLength?b._iDisplayStart+b._iDisplayLength<b.fnRecordsDisplay()&&(b._iDisplayStart+=b._iDisplayLength):b._iDisplayStart=0,j.oApi._fnCalculateEnd(b);for(;d<b._iDisplayStart;){b._iDisplayStart=0<=b._iDisplayLength?b._iDisplayStart-b._iDisplayLength:0;if(0>b._iDisplayStart)b._iDisplayStart=
0;j.oApi._fnCalculateEnd(b)}j.oApi._fnDraw(b);m=e}d=y(a);q=a;l=d[0];h=d[1];var f,i,k,n,g;if(c){f=document.documentElement.clientHeight;d=document.documentElement.clientWidth;i=document.body.scrollTop||document.documentElement.scrollTop;e=document.body.scrollLeft||document.documentElement.scrollLeft;k=a.offsetHeight;n=a.offsetWidth;g=a;var o=0,p=0;if(g.offsetParent){o=g.offsetLeft;p=g.offsetTop;for(g=g.offsetParent;g;)o+=g.offsetLeft,p+=g.offsetTop,g=g.offsetParent}g=[o,p];if(j&&"undefined"!=typeof b.oScroll&&
(""!==b.oScroll.sX||""!==b.oScroll.sY))g[1]-=$(b.nTable.parentNode).scrollTop(),g[0]-=$(b.nTable.parentNode).scrollLeft();if(g[1]+k>i+f)f=g[1]+k-f,document.documentElement.scrollTop=f,document.body.scrollTop=f;else if(g[1]<i)f=g[1],document.documentElement.scrollTop=f,document.body.scrollTop=f;if(g[0]+n>e+d)d=g[0]+n-d,document.documentElement.scrollLeft=d,document.body.scrollLeft=d;else if(g[0]<e)d=g[0],document.documentElement.scrollLeft=d,document.body.scrollLeft=d}if(j&&"undefined"!=typeof b.oScroll&&
(""!==b.oScroll.sX||""!==b.oScroll.sY)){b=b.nTable.parentNode;f=b.clientHeight;d=b.clientWidth;i=b.scrollTop;e=b.scrollLeft;k=a.offsetHeight;n=a.offsetWidth;if(a.offsetTop+k>f+i)b.scrollTop=a.offsetTop+k-f;else if(a.offsetTop<i)b.scrollTop=a.offsetTop;if(a.offsetLeft+n>d+e)b.scrollLeft=a.offsetLeft+n-d;else if(a.offsetLeft<e)b.scrollLeft=a.offsetLeft}m||(m=!0);v("focus",l,h)}}function w(){z(q);q=h=l=null;m=!1}function z(a){jQuery(a).removeClass(s);jQuery(a).parent().removeClass(s);v("blur",l,h)}function B(){for(var a=
this;"TD"!=a.nodeName;)a=a.parentNode;k(a);m||(m=!0)}function C(a){if(D.block||!m||a.metaKey||a.altKey||a.ctrlKey)return!0;var c;c=t.getElementsByTagName("tr")[0].getElementsByTagName("td").length;var b;if(j){b=j.fnSettings().aiDisplay.length;var d=A(q);if(null===d)return;l=d[0];h=d[1]}else b=t.getElementsByTagName("tr").length;d=9==a.keyCode&&a.shiftKey?-1:a.keyCode;switch(d){case 13:return a.preventDefault(),a.stopPropagation(),v("action",l,h),!0;case 27:if(!v("esc",l,h)){w();return}a=l;c=h;break;
case -1:case 37:if(0<l)a=l-1,c=h;else if(0<h)a=c-1,c=h-1;else return-1==d&&x?(o=!0,n.focus(),setTimeout(function(){o=!1},0),m=!1,w(),!0):!1;break;case 38:if(0<h)a=l,c=h-1;else return!1;break;case 9:case 39:if(l<c-1)a=l+1,c=h;else if(h<b-1)a=0,c=h+1;else return 9==d&&x?(o=!0,n.focus(),setTimeout(function(){o=!1},0),m=!1,w(),!0):!1;break;case 40:if(h<b-1)a=l,c=h+1;else return!1;break;default:return!0}k(r(a,c));return!1}function r(a,c){if(j){var b=j.fnSettings();return"undefined"!=typeof b.aoData[b.aiDisplay[c]]?
b.aoData[b.aiDisplay[c]].nTr.getElementsByTagName("td")[a]:null}return jQuery("tr:eq("+c+")>td:eq("+a+")",t)[0]}function y(a){if(j){var c=j.fnSettings();return[jQuery("td",a.parentNode).index(a),jQuery("tr",a.parentNode.parentNode).index(a.parentNode)+c._iDisplayStart]}return[jQuery("td",a.parentNode).index(a),jQuery("tr",a.parentNode.parentNode).index(a.parentNode)]}function A(a){for(var c=j.fnSettings(),b=0,d=c.aiDisplay.length;b<d;b++)for(var e=c.aoData[c.aiDisplay[b]].nTr.getElementsByTagName("td"),
f=0,h=e.length;f<h;f++)if(e[f]==a)return[f,b];return null}this.block=!1;this.event={remove:{}};this.fnGetCurrentPosition=function(){return[l,h]};this.fnGetCurrentData=function(){return q.innerHTML};this.fnGetCurrentTD=function(){return q};this.fnSetPosition=function(a,c){"object"==typeof a&&a.nodeName?k(a):k(r(a,c))};var t=null,q=null,l=null,h=null,D=null,s="focus",m=!1,i={action:[],esc:[],focus:[],blur:[]},j=null,x,n,o=!1,p;for(p in i)p&&(this.event[p]=F(p),this.event.remove[p]=G(p));(function(a,
c){D=c;"undefined"==typeof a&&(a={});if("undefined"==typeof a.focus)a.focus=[0,0];"undefined"==typeof a.table?a.table=jQuery("table.KeyTable")[0]:$(a.table).addClass("KeyTable");if("undefined"!=typeof a.focusClass)s=a.focusClass;if("undefined"!=typeof a.datatable)j=a.datatable;if("undefined"==typeof a.initScroll)a.initScroll=!0;if("undefined"==typeof a.form)a.form=!1;x=a.form;t=a.table.getElementsByTagName("tbody")[0];if(x){var b=document.createElement("div");n=document.createElement("input");b.style.height=
"1px";b.style.width="0px";b.style.overflow="hidden";if("undefined"!=typeof a.tabIndex)n.tabIndex=a.tabIndex;b.appendChild(n);a.table.parentNode.insertBefore(b,a.table.nextSibling);jQuery(n).focus(function(){o||(m=!0,o=!1,"undefined"!=typeof a.focus.nodeName?k(a.focus,a.initScroll):k(r(a.focus[0],a.focus[1]),a.initScroll),setTimeout(function(){n.blur()},0))});m=!1}else"undefined"!=typeof a.focus.nodeName?k(a.focus,a.initScroll):k(r(a.focus[0],a.focus[1]),a.initScroll),m||(m=!0);jQuery.browser.mozilla||
jQuery.browser.opera?jQuery(document).bind("keypress",C):jQuery(document).bind("keydown",C);j?jQuery("tbody td",j.fnSettings().nTable).live("click",B):jQuery("td",t).live("click",B);jQuery(document).click(function(b){for(var b=b.target,c=!1;b;){if(b==a.table){c=!0;break}b=b.parentNode}c||w()})})(E,this)};
