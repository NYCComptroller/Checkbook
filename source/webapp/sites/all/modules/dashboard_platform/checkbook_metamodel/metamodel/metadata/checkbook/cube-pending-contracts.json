{
    "datasets":{
        "pending_contracts":{
            "datasourceName":"main",
            "source":"pending_contracts"
        }
    },
    "cubes": {
        "pending_contracts": {
            "sourceDatasetName": "pending_contracts",
            "dimensions": [
                {
                    "name": "received_date",
                    "levels": [
                       		{
                            	"name": "received_date",
                            	"sourceColumnName": "cif_received_date"
                            }
                    ]
                },
				{
                    "name": "awarding_agency_name",
                    "levels": [
                       		{
                            	"name": "awarding_agency_name",
                            	"sourceColumnName": "awarding_agency_name"
                            }
                    ]
                },
				{
                    "name": "awarding_agency_short_name",
                    "levels": [
                       		{
                            	"name": "awarding_agency_short_name",
                            	"sourceColumnName": "awarding_agency_short_name"
                            }
                    ]
                },
				{
                    "name": "awarding_agency_id",
                    "levels": [
                       		{
                            	"name": "awarding_agency_id",
                            	"sourceColumnName": "awarding_agency_id"
                            }
                    ]
                },
                {
                    "name": "agency",
                    "levels": [
                        {
                            "name": "agency",
                            "datasetName": "agency",
                            "sourceColumnName": "awarding_agency_id"
                        }
                    ]
                },
                {
                    "name": "vendor_customer_code",
                    "levels": [
                        {
                            "name": "vendor_customer_code",
                            "sourceColumnName": "vendor_customer_code"
                        }
                    ]
                },
                {
                    "name": "vendor",
                    "levels": [
                        {
                            "name": "vendor",
                            "sourceColumnName": "vendor_id"
                        }
                    ]
                },                
				{
                    "name": "vendor_legal_name",
                    "levels": [
                       		{
                            	"name": "vendor_legal_name",
                            	"sourceColumnName": "vendor_legal_name"
                            }
                    ]
                }      ,
				{
                    "name": "pending_contract_purpose",
                    "levels": [
                       		{
                            	"name": "pending_contract_purpose",
                            	"sourceColumnName": "description"
                            }
                    ]
                },
				{
                    "name": "award_method_name",
                    "levels": [
                       		{
                            	"name": "award_method_name",
                            	"sourceColumnName": "award_method_name"
                            }
                    ]
                },
				{
                    "name": "award_method_code",
                    "levels": [
                       		{
                            	"name": "award_method_code",
                            	"sourceColumnName": "award_method_code"
                            }
                    ]
                },
                {
                    "name": "award_method",
                    "levels": [
                        {
                            "name": "award_method",
                            "datasetName":"award_method",
                            "sourceColumnName": "award_method_id"
                        }
                    ]
                },
                {
                    "name": "award_method_id",
                    "levels": [
                       		{
                            	"name": "award_method_id",
                            	"sourceColumnName": "award_method_id"
                            }
                    ]
                },
				{
                    "name": "pending_contract_number",
                    "levels": [
                       		{
                            	"name": "pending_contract_number",
                            	"sourceColumnName": "contract_number"
                            }
                    ]
                },
                {
                    "name": "contract_number",
                    "levels": [
                       		{
                            	"name": "contract_number",
                            	"sourceColumnName": "fms_contract_number"
                            }
                    ]
                },
				{
                    "name": "dollar_difference",
                    "levels": [
                       		{
                            	"name": "dollar_difference",
                            	"sourceColumnName": "dollar_difference"
                            }
                    ]
                },
				{
                    "name": "percent_difference",
                    "levels": [
                       		{
                            	"name": "percent_difference",
                            	"sourceColumnName": "percent_difference"
                            }
                    ]
                },
				{
                    "name": "document_code",
                    "levels": [
                            {
                                "name": "document_code",
                                "datasetName": "ref_document_code",
                                "sourceColumnName": "document_code_id"
                            }
                    ]
                },
                {
                    "name": "original_agreement_id",
                    "levels": [
                            {
                                "name": "original_agreement_id",
                                "sourceColumnName": "original_agreement_id"
                            }
                    ]
                },
                {
                    "name": "document_agency_short_name",
                    "levels": [
                        {
                            "name": "document_agency_short_name",
                            "sourceColumnName": "document_agency_short_name"
                        }
                    ]
                },
                {
                    "name": "document_agency_name",
                    "levels": [
                        {
                            "name": "document_agency_name",
                            "sourceColumnName": "document_agency_name"
                        }
                    ]
                },
                {
                    "name": "document_agency_code",
                    "levels": [
                        {
                            "name": "document_agency_code",
                            "sourceColumnName": "document_agency_code"
                        }
                    ]
                },
                {
                    "name": "document_agency_id",
                    "levels": [
                        {
                            "name": "document_agency_id",
                            "sourceColumnName": "document_agency_id"
                        }
                    ]
                },
                {
                    "name": "tracking_number",
                    "levels": [
                        {
                            "name": "tracking_number",
                            "sourceColumnName": "tracking_number"
                        }
                    ]
                },
                {
                    "name": "board_award_number",
                    "levels": [
                        {
                            "name": "board_award_number",
                            "sourceColumnName": "board_award_number"
                        }
                    ]
                },
                {
                    "name": "award_size",
                    "levels": [
                        {
                            "name": "award_size",
                            "datasetName":"award_size",
                            "sourceColumnName": "award_size_id"
                        }
                    ]
                },
                {
                    "name": "version_number",
                    "levels": [
                        {
                            "name": "version_number",
                            "sourceColumnName": "version_number"
                        }
                    ]
                },
                {
                    "name": "document_version",
                    "levels": [
                        {
                            "name": "document_version",
                            "sourceColumnName": "document_version"
                        }
                    ]
                },
                {
                    "name": "industry",
                    "levels": [
                        {
                            "name": "industry",
                            "datasetName":"industry_type",
                            "sourceColumnName": "industry_type_id"
                        }
                    ]
                }
            ],
            "measures": {
                "original_amount_sum": {
                    "function": "SUM(COALESCE(original_maximum_amount,0))"
                },
                "current_amount_sum": {
                    "function": "SUM(COALESCE(revised_maximum_amount,0))"
                },
				"total_contracts": {
					"function": "COUNT(contract_number)"
                },
                "txcount": {
                    "function": "COUNT(*)"
                },
                "total_contract_amount":{
                    "function": "SUM(revised_maximum_amount - registered_contract_max_amount)"
                },
                "total_revised_maximum_amount": {
                    "function": "SUM(COALESCE(revised_maximum_amount,0))"
                },
                "g100m_count": {
                    "function": "SUM(CASE WHEN COALESCE(revised_maximum_amount,0) > 100000000 THEN 1 ELSE 0 END)"
                },
                "g50m_le100m_count": {
                    "function": "SUM(CASE WHEN COALESCE(revised_maximum_amount,0) > 50000000 AND COALESCE(revised_maximum_amount,0) <= 100000000 THEN 1 ELSE 0 END)"
                },
                "g25m_le50m_count": {
                    "function": "SUM(CASE WHEN COALESCE(revised_maximum_amount,0) > 25000000 AND COALESCE(revised_maximum_amount,0) <= 50000000 THEN 1 ELSE 0 END)"
                },
                "g10m_le25m_count": {
                    "function": "SUM(CASE WHEN COALESCE(revised_maximum_amount,0) > 10000000 AND COALESCE(revised_maximum_amount,0) <= 25000000 THEN 1 ELSE 0 END)"
                },
                "ge1m_le10m_count": {
                    "function": "SUM(CASE WHEN COALESCE(revised_maximum_amount,0) >= 1000000 AND COALESCE(revised_maximum_amount,0) <= 10000000 THEN 1 ELSE 0 END)"
                },
                "less1m_count": {
                    "function": "SUM(CASE WHEN COALESCE(revised_maximum_amount,0) < 1000000 THEN 1 ELSE 0 END)"
                },
                "total_num_master_agreements": {
                    "function": "SUM(CASE WHEN document_code IN ('MA1','MMA1') THEN 1 ELSE 0 END)"
                },
                "total_num_standalone_contracts": {
                    "function": "SUM(CASE WHEN document_code IN ('CT1','CTA1') THEN  1 ELSE 0 END)"
                },
                "total_num_contracts": {
                    "function": "SUM(CASE WHEN document_code IN ('MA1','MMA1','CT1','CTA1','MAR','CTR') THEN  1 ELSE 0 END)"
                },
                "total_num_rev_pending_contracts": {
                    "function": "SUM(CASE WHEN document_code IN ('RCT1') THEN  1 ELSE 0 END)"
                }
            }
        }
    },
    "references": {
        "pending_contracts__ref_document_code": [
            {"datasetName": "pending_contracts", "columnNames": ["document_code_id"]},
            {"datasetName": "ref_document_code", "columnNames": ["document_code_id"]}
        ],
 		"pending_contracts__ref_date": [
            {"datasetName": "pending_contracts", "columnNames": ["cif_received_date_id"]},
            {"datasetName": "date_id", "columnNames": ["date_id"]}
        ],
        "pending_contracts__ref_industry_type": [
            {"datasetName": "pending_contracts", "columnNames": ["industry_type_id"]},
            {"datasetName": "industry_type", "columnNames": ["industry_type_id"]}
        ]
    }
}
