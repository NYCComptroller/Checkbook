widget_name,aggregate_table_name,create_table,query1,query2,execution_order
SubVenSpendingByCOAEntitiesAndFiscalYear,aggregateon_subven_spending_coa_entities,"CREATE TABLE aggregateon_subven_spending_coa_entities (
	agency_id smallint,
	spending_category_id smallint,
	vendor_id integer,
	prime_vendor_id integer,
	prime_minority_type_id smallint,
	minority_type_id smallint,
	industry_type_id smallint,
	month_id int,
	year_id smallint,
	type_of_year char(1),
	total_spending_amount numeric(16,2),
	total_disbursements integer
	) DISTRIBUTED BY (vendor_id)  ","SELECT agency_id,
       	spending_category_id, 
       	vendor_id,
       	prime_vendor_id,
       	prime_minority_type_id,
       	minority_type_id,
       	industry_type_id,
       	check_eft_issued_cal_month_id as month_id,
       	check_eft_issued_nyc_year_id as year_id,
       	'B' as type_of_year,
       	sum(check_amount) total_spending_amount,
       	count(*) as total_disbursements
  FROM subcontract_spending_details 
  GROUP BY 1,2,3,4,5,6,7,8,9,10","SELECT 	agency_id,
       	spending_category_id,   
       	vendor_id,
       	prime_vendor_id,
       	prime_minority_type_id,
       	minority_type_id,
       	industry_type_id,
       	check_eft_issued_cal_month_id AS month_id,
        calendar_fiscal_year_id AS year_id,
       	'C' as type_of_year,
       	sum(check_amount) total_spending_amount,
       	count(*) as total_disbursements
  FROM subcontract_spending_details
  GROUP BY 1,2,3,4,5,6,7,8,9,10",51
SubVenSpendingByContractId,aggregateon_subven_spending_contract,"CREATE TABLE aggregateon_subven_spending_contract (
    agreement_id bigint,
    document_id character varying(20),
    sub_contract_id character varying(20),
    document_code character varying(8),
	vendor_id integer,
	prime_vendor_id integer,
	prime_minority_type_id smallint,
	minority_type_id smallint,
	industry_type_id smallint,
	agency_id smallint,
	description character varying(256),	
	spending_category_id smallint,
	year_id smallint,
	type_of_year char(1),
	total_spending_amount numeric(16,2), 
	total_contract_amount numeric(16,2)
	) DISTRIBUTED BY (agreement_id)","SELECT agreement_id, contract_number, sub_contract_id, contract_document_code, vendor_id, prime_vendor_id, prime_minority_type_id, minority_type_id, industry_type_id, agency_id, description,  
spending_category_id, year_id, type_of_year,
 sum(total_spending_amount) total_spending_amount,
  sum(contract_amount) total_contract_amount
FROM
(SELECT agreement_id as agreement_id, 
       contract_number as contract_number,
       sub_contract_id as sub_contract_id,
       contract_document_code as contract_document_code,
       contract_vendor_id as vendor_id,
       contract_prime_vendor_id as prime_vendor_id,
       contract_prime_minority_type_id as prime_minority_type_id,
       contract_minority_type_id as minority_type_id,
       contract_industry_type_id as industry_type_id,
       contract_agency_id as agency_id,
       purpose as description,
       spending_category_id,
       check_eft_issued_nyc_year_id AS year_id,
       'B' as type_of_year,
       sum(check_amount) AS total_spending_amount,
       MIN(maximum_contract_amount) AS contract_amount
  FROM subcontract_spending_details 
  WHERE agreement_id IS NOT NULL AND contract_number IS NOT NULL
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14
) X
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14 ","SELECT agreement_id, contract_number, sub_contract_id, contract_document_code, vendor_id, prime_vendor_id, prime_minority_type_id, minority_type_id, industry_type_id, agency_id, description,  
 spending_category_id, year_id, type_of_year,
 sum(total_spending_amount) total_spending_amount,
  sum(contract_amount) total_contract_amount
  FROM
(SELECT agreement_id as agreement_id,
       contract_number as contract_number,
       sub_contract_id as sub_contract_id,
       contract_document_code as contract_document_code,
       contract_vendor_id_cy as vendor_id,
       contract_prime_vendor_id_cy as prime_vendor_id,
       contract_prime_minority_type_id_cy as prime_minority_type_id,
       contract_minority_type_id_cy as minority_type_id,
       contract_industry_type_id_cy as industry_type_id,
       contract_agency_id_cy as agency_id,
       purpose_cy as description,
       calendar_fiscal_year_id AS year_id,   
       spending_category_id,
       'C' as type_of_year,
       sum(check_amount) AS total_spending_amount,
       MIN(maximum_contract_amount_cy) AS contract_amount
  FROM subcontract_spending_details
  WHERE agreement_id IS NOT NULL AND contract_number IS NOT NULL
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14 ) X
 GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14 ",52
SubVenSpendingByVendorId,aggregateon_subven_spending_vendor,"CREATE TABLE aggregateon_subven_spending_vendor (
	vendor_id integer,
	prime_vendor_id integer,
	prime_minority_type_id smallint,
	minority_type_id smallint,
	industry_type_id smallint,
	agency_id smallint,
	spending_category_id smallint,
	year_id smallint,
	type_of_year char(1),
	total_spending_amount numeric(16,2), 
	total_contract_amount numeric(16,2),
	total_sub_contracts integer,
	is_all_categories char(1)
	) DISTRIBUTED BY (vendor_id)","SELECT X.vendor_id, X.prime_vendor_id, X.prime_minority_type_id, X.minority_type_id, X.industry_type_id, X.agency_id, X.spending_category_id,   
       X.year_id,
       X.type_of_year,
       X.total_spending_amount,
       Y.total_contract_amount,
       Y.total_sub_contracts,
       'N' as is_all_categories
  FROM (SELECT agency_id,
               vendor_id,
               prime_vendor_id,
               prime_minority_type_id,
               minority_type_id,
               industry_type_id,
               spending_category_id,
               check_eft_issued_nyc_year_id AS year_id,
               'B' as type_of_year,
               sum(check_amount) AS total_spending_amount
          FROM    subcontract_spending_details a 
		  WHERE  a.spending_category_id <> 2
GROUP BY 1,2,3,4,5,6,7,8,9) X
LEFT JOIN (SELECT vendor_id, prime_vendor_id, prime_minority_type_id, minority_type_id, industry_type_id, agency_id, 
spending_category_id, year_id, sum(total_contract_amount) as total_contract_amount, count(*) as total_sub_contracts
 FROM aggregateon_subven_spending_contract WHERE type_of_year = 'B' 
 GROUP BY 1,2,3,4,5,6,7,8) Y
 ON X.vendor_id = Y.vendor_id AND X.prime_vendor_id = Y.prime_vendor_id AND X.prime_minority_type_id = Y.prime_minority_type_id
 AND X.agency_id = Y.agency_id  AND X.spending_category_id = Y.spending_category_id AND X.year_id = Y.year_id 
 AND X.minority_type_id = Y.minority_type_id AND X.industry_type_id = Y.industry_type_id
 UNION ALL
   SELECT X.vendor_id, X.prime_vendor_id, X.prime_minority_type_id, X.minority_type_id, X.industry_type_id, X.agency_id, X.spending_category_id::smallint,     
       X.year_id,
       X.type_of_year,
       X.total_spending_amount,
       Y.total_contract_amount,
       Y.total_sub_contracts,
       'Y' as is_all_categories
  FROM (SELECT agency_id,
               vendor_id,  
               prime_vendor_id,
               prime_minority_type_id, 
               minority_type_id,  
               industry_type_id,           
               check_eft_issued_nyc_year_id AS year_id,
               NULL as spending_category_id,
               'B' as type_of_year,
               sum(check_amount) AS total_spending_amount
          FROM    subcontract_spending_details a 
		  WHERE  a.spending_category_id <> 2
GROUP BY 1,2,3,4,5,6,7,8,9) X
LEFT JOIN (SELECT vendor_id, prime_vendor_id, prime_minority_type_id, minority_type_id, industry_type_id, agency_id, 
year_id, SUM(total_contract_amount) as total_contract_amount, count(*) as total_sub_contracts
FROM 
(SELECT agreement_id, vendor_id, prime_vendor_id, prime_minority_type_id, minority_type_id, industry_type_id, agency_id, year_id, MIN(total_contract_amount) as total_contract_amount
 FROM aggregateon_subven_spending_contract WHERE type_of_year = 'B' 
 GROUP BY 1,2,3,4,5,6,7,8) Z GROUP BY 1,2,3,4,5,6,7) Y
 ON X.vendor_id = Y.vendor_id AND X.prime_vendor_id = Y.prime_vendor_id AND X.prime_minority_type_id = Y.prime_minority_type_id
 AND X.agency_id = Y.agency_id  AND X.year_id = Y.year_id 
 AND X.minority_type_id = Y.minority_type_id AND X.industry_type_id = Y.industry_type_id ","SELECT X.vendor_id, X.prime_vendor_id, X.prime_minority_type_id, X.minority_type_id, X.industry_type_id, X.agency_id, X.spending_category_id, 
       X.year_id,
       X.type_of_year,
       X.total_spending_amount,
       Y.total_contract_amount,
       Y.total_sub_contracts,
       'N' as is_all_categories
  FROM (SELECT agency_id,
               vendor_id,
               prime_vendor_id,
               prime_minority_type_id,
               minority_type_id,
               industry_type_id, 
               spending_category_id,
               calendar_fiscal_year_id AS year_id,
               'C' as type_of_year,
               sum(check_amount) AS total_spending_amount
          FROM    subcontract_spending_details a 
		  WHERE  a.spending_category_id <> 2
GROUP BY 1,2,3,4,5,6,7,8,9) X
LEFT JOIN (SELECT vendor_id, prime_vendor_id, prime_minority_type_id, minority_type_id, industry_type_id, agency_id, 
spending_category_id, year_id, sum(total_contract_amount) as total_contract_amount, count(*) as total_sub_contracts
 FROM aggregateon_subven_spending_contract WHERE type_of_year = 'C' 
 GROUP BY 1,2,3,4,5,6,7,8) Y
 ON X.vendor_id = Y.vendor_id AND X.prime_vendor_id = Y.prime_vendor_id AND X.prime_minority_type_id = Y.prime_minority_type_id
 AND X.agency_id = Y.agency_id AND X.spending_category_id = Y.spending_category_id  AND X.year_id = Y.year_id 
 AND X.minority_type_id = Y.minority_type_id AND X.industry_type_id = Y.industry_type_id
 UNION ALL
   SELECT X.vendor_id, X.prime_vendor_id, X.prime_minority_type_id, X.minority_type_id, X.industry_type_id, X.agency_id, X.spending_category_id::smallint,  
       X.year_id,
       X.type_of_year,
       X.total_spending_amount,
       Y.total_contract_amount,
       Y.total_sub_contracts,
       'Y' as is_all_categories
  FROM (SELECT agency_id,
               vendor_id,
               prime_vendor_id,
               prime_minority_type_id,
               minority_type_id,
               industry_type_id,
               calendar_fiscal_year_id AS year_id,
               NULL as spending_category_id,
               'C' as type_of_year,
               sum(check_amount) AS total_spending_amount
          FROM    subcontract_spending_details a 
		  WHERE  a.spending_category_id <> 2
GROUP BY 1,2,3,4,5,6,7,8,9) X
LEFT JOIN (SELECT vendor_id, prime_vendor_id, prime_minority_type_id, minority_type_id, industry_type_id, agency_id, 
year_id, SUM(total_contract_amount) as total_contract_amount, count(*) as total_sub_contracts
FROM 
(SELECT agreement_id, vendor_id, prime_vendor_id, prime_minority_type_id, minority_type_id, industry_type_id, agency_id, year_id, MIN(total_contract_amount) as total_contract_amount
 FROM aggregateon_subven_spending_contract WHERE type_of_year = 'C' 
 GROUP BY 1,2,3,4,5,6,7,8) Z GROUP BY 1,2,3,4,5,6,7) Y
 ON X.vendor_id = Y.vendor_id AND X.prime_vendor_id = Y.prime_vendor_id AND X.prime_minority_type_id = Y.prime_minority_type_id
 AND X.agency_id = Y.agency_id AND X.year_id = Y.year_id  
 AND X.minority_type_id = Y.minority_type_id AND X.industry_type_id = Y.industry_type_id",53
SubVenPopulateContractSpendingByYear,mid_aggregateon_subven_disbursement_spending_year,"CREATE TABLE mid_aggregateon_subven_disbursement_spending_year(
	original_agreement_id bigint,
	fiscal_year smallint,
	fiscal_year_id smallint,
	check_amount numeric(16,2),
	type_of_year char(1))
DISTRIBUTED BY (original_agreement_id)","SELECT agreement_id,
 a.fiscal_year,
 year_id,
 SUM(check_amount),
 'B' as type_of_year
FROM subcontract_spending_details a JOIN ref_year b ON a.fiscal_year = b.year_value AND agreement_id IS NOT NULL
GROUP  BY 1,2,3,5
UNION ALL
SELECT agreement_id,
 a.calendar_fiscal_year,
 year_id,
 SUM(check_amount),
 'C' as type_of_year
FROM subcontract_spending_details a JOIN ref_year b ON a.calendar_fiscal_year = b.year_value AND agreement_id IS NOT NULL
GROUP  BY 1,2,3,5","",55
SubVenContractLandingWidgets,aggregateon_subven_contracts_cumulative_spending,"CREATE TABLE aggregateon_subven_contracts_cumulative_spending(
	original_agreement_id bigint,
	fiscal_year smallint,
	fiscal_year_id smallint,
	document_code_id smallint,
	description varchar,
	contract_number varchar,
	sub_contract_id character varying(20),
	vendor_id int,
	prime_vendor_id int,
	prime_minority_type_id smallint,
	minority_type_id smallint,
	award_method_id smallint,
	agency_id smallint,
	industry_type_id smallint,
	award_size_id smallint,
	original_contract_amount numeric(16,2),
	maximum_contract_amount numeric(16,2),
	spending_amount_disb numeric(16,2),
	spending_amount numeric(16,2),
	current_year_spending_amount numeric(16,2),
	dollar_difference numeric(16,2),
	percent_difference numeric(16,2),
	status_flag char(1),
	type_of_year char(1)	
) DISTRIBUTED BY (vendor_id)","SELECT  a.original_agreement_id,
		a.fiscal_year,
		ry.year_id,
		document_code_id,
		MIN(description),
		MIN(contract_number),
		MIN(sub_contract_id),
		MIN(vendor_id),
		MIN(prime_vendor_id),
		MIN(prime_minority_type_id),
		MIN(minority_type_id),
		MIN(award_method_id),
		MIN(a.agency_id) ,
		MIN(industry_type_id),
		MIN(award_size_id),
		MIN(original_contract_amount),
		MIN(maximum_contract_amount),
		SUM(coalesce(b.check_amount,0)),
		MIN(a.rfed_amount),
		SUM(CASE WHEN b.fiscal_year IS NOT NULL AND a.fiscal_year = b.fiscal_year THEN coalesce(b.check_amount,0) ELSE 0 END) as current_year_spending_amount,
		MIN(dollar_difference),
		MIN(percent_difference),
		'A' as status_flag,
		'B' as type_of_year
	FROM 	sub_agreement_snapshot_expanded a 
	LEFT JOIN ref_year ry ON a.fiscal_year = ry.year_value 
	LEFT JOIN mid_aggregateon_subven_disbursement_spending_year b ON a.original_agreement_id = b.original_agreement_id AND a.fiscal_year >= b.fiscal_year AND b.type_of_year ='B'
	WHERE  a.status_flag='A'
	GROUP BY 1,2,3,4 
UNION ALL
SELECT a.original_agreement_id,
	a.fiscal_year,
	ry.year_id,
	document_code_id,
	MIN(description),
	MIN(contract_number),
	MIN(sub_contract_id),
	MIN(vendor_id),
	MIN(prime_vendor_id),
	MIN(prime_minority_type_id),
	MIN(minority_type_id),
	MIN(award_method_id),
	MIN(a.agency_id) ,
	MIN(industry_type_id),
	MIN(award_size_id),
	MIN(original_contract_amount),
	MIN(maximum_contract_amount),
	SUM(coalesce(b.check_amount,0)) ,
	MIN(a.rfed_amount),
	SUM(CASE WHEN b.fiscal_year IS NOT NULL AND a.fiscal_year = b.fiscal_year THEN coalesce(b.check_amount,0) ELSE 0 END) as current_year_spending_amount,
	MIN(dollar_difference),
	MIN(percent_difference),
	'R' as status_flag, 
	'B' as type_of_year	
	FROM 	sub_agreement_snapshot_expanded a 
	LEFT JOIN ref_year ry ON a.fiscal_year = ry.year_value 
	LEFT JOIN mid_aggregateon_subven_disbursement_spending_year b ON a.original_agreement_id = b.original_agreement_id AND a.fiscal_year >= b.fiscal_year AND b.type_of_year ='B' 
	WHERE   a.status_flag='R'
	GROUP BY 1,2,3,4 ","SELECT  a.original_agreement_id,
		a.fiscal_year,
		ry.year_id,
		document_code_id,
		MIN(description),
		MIN(contract_number),
		MIN(sub_contract_id),
		MIN(vendor_id),
		MIN(prime_vendor_id),
		MIN(prime_minority_type_id),
		MIN(minority_type_id),
		MIN(award_method_id),
		MIN(a.agency_id) ,
		MIN(industry_type_id),
		MIN(award_size_id),
		MIN(original_contract_amount),
		MIN(maximum_contract_amount),
		SUM(coalesce(b.check_amount,0)),
		MIN(a.rfed_amount),
		SUM(CASE WHEN b.fiscal_year IS NOT NULL AND a.fiscal_year = b.fiscal_year THEN coalesce(b.check_amount,0) ELSE 0 END) as current_year_spending_amount,
		MIN(dollar_difference),
		MIN(percent_difference),
		'A' as status_flag,
		'C' as type_of_year
	FROM 	sub_agreement_snapshot_expanded_cy a 
	LEFT JOIN ref_year ry ON a.fiscal_year = ry.year_value 
	LEFT JOIN mid_aggregateon_subven_disbursement_spending_year b ON a.original_agreement_id = b.original_agreement_id AND a.fiscal_year >= b.fiscal_year AND b.type_of_year ='C'
	WHERE  a.status_flag='A' 
	GROUP BY 1,2,3,4
UNION ALL
SELECT a.original_agreement_id,
	a.fiscal_year,
	ry.year_id,
	document_code_id,
	MIN(description),
	MIN(contract_number),
	MIN(sub_contract_id),
	MIN(vendor_id),
	MIN(prime_vendor_id),
	MIN(prime_minority_type_id),
	MIN(minority_type_id),
	MIN(award_method_id),
	MIN(a.agency_id),
	MIN(industry_type_id),
	MIN(award_size_id),
	MIN(original_contract_amount),
	MIN(maximum_contract_amount),
	SUM(coalesce(b.check_amount,0)) ,
	MIN(a.rfed_amount),
	SUM(CASE WHEN b.fiscal_year IS NOT NULL AND a.fiscal_year = b.fiscal_year THEN coalesce(b.check_amount,0) ELSE 0 END) as current_year_spending_amount,
	MIN(dollar_difference),
	MIN(percent_difference),
	'R' as status_flag, 
	'C' as type_of_year	
	FROM 	sub_agreement_snapshot_expanded_cy a 
	LEFT JOIN ref_year ry ON a.fiscal_year = ry.year_value 
	LEFT JOIN mid_aggregateon_subven_disbursement_spending_year b ON a.original_agreement_id = b.original_agreement_id AND a.fiscal_year >= b.fiscal_year AND b.type_of_year ='C'
	WHERE   a.status_flag='R'
	GROUP BY 1,2,3,4",56
SubVenContractLandingTopGraph,aggregateon_subven_contracts_spending_by_month,"CREATE TABLE aggregateon_subven_contracts_spending_by_month(
 original_agreement_id bigint,
 fiscal_year smallint,
 fiscal_year_id smallint,
 document_code_id smallint,
 month_id integer,
 vendor_id int,
 prime_vendor_id int,
 prime_minority_type_id smallint,
 minority_type_id smallint,
 award_method_id smallint,
 agency_id smallint,
 industry_type_id smallint,
 award_size_id smallint,
 spending_amount numeric(16,2),
 status_flag char(1),
 type_of_year char(1) 
) DISTRIBUTED BY (vendor_id)","SELECT  a.original_agreement_id,
		a.fiscal_year,
		ry.year_id,
		document_code_id,
		b.check_eft_issued_cal_month_id as month_id,		
		a.vendor_id,
		a.prime_vendor_id,
		a.prime_minority_type_id,
		a.minority_type_id,
		a.award_method_id,
		a.agency_id ,
		a.industry_type_id,
		a.award_size_id,
		SUM(coalesce(b.check_amount,0)),		
		'A' as status_flag,
		'B' as type_of_year
	FROM 	sub_agreement_snapshot_expanded a 
	LEFT JOIN ref_year ry ON a.fiscal_year = ry.year_value 
	LEFT JOIN subcontract_spending_details b ON a.original_agreement_id = b.agreement_id AND a.fiscal_year = b.fiscal_year 
	WHERE  a.status_flag='A' 
	GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13
UNION ALL
SELECT a.original_agreement_id,
		a.fiscal_year,
		ry.year_id,
		document_code_id,
		b.check_eft_issued_cal_month_id as month_id,		
		a.vendor_id,
		a.prime_vendor_id,
		a.prime_minority_type_id,
		a.minority_type_id,
		a.award_method_id,
		a.agency_id ,	
		a.industry_type_id,
		a.award_size_id,
		SUM(coalesce(b.check_amount,0)),
		'R' as status_flag, 
		'B' as type_of_year	
	FROM 	sub_agreement_snapshot_expanded a 
	LEFT JOIN ref_year ry ON a.fiscal_year = ry.year_value 
	LEFT JOIN subcontract_spending_details b ON a.original_agreement_id = b.agreement_id AND a.fiscal_year = b.fiscal_year 
	WHERE   a.status_flag='R' 
	GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13 ","SELECT  a.original_agreement_id,
		a.fiscal_year,
		ry.year_id,
		document_code_id,
		b.check_eft_issued_cal_month_id as month_id,		
		a.vendor_id,
		a.prime_vendor_id,
		a.prime_minority_type_id,
		a.minority_type_id,
		a.award_method_id,
		a.agency_id ,	
		a.industry_type_id,
		a.award_size_id,
		SUM(coalesce(b.check_amount,0)),
		'A' as status_flag,
		'C' as type_of_year
	FROM 	sub_agreement_snapshot_expanded_cy a 
	LEFT JOIN ref_year ry ON a.fiscal_year = ry.year_value 
	LEFT JOIN subcontract_spending_details b ON a.original_agreement_id = b.agreement_id AND a.fiscal_year = b.calendar_fiscal_year 
	WHERE  a.status_flag='A' 
	GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13
UNION ALL
SELECT  a.original_agreement_id,
		a.fiscal_year,
		ry.year_id,
		document_code_id,
		b.check_eft_issued_cal_month_id as month_id,		
		a.vendor_id,
		a.prime_vendor_id,
		a.prime_minority_type_id,
		a.minority_type_id,
		a.award_method_id,
		a.agency_id ,	
		a.industry_type_id,
		a.award_size_id,
		SUM(coalesce(b.check_amount,0)),
	'R' as status_flag, 
	'C' as type_of_year	
	FROM 	sub_agreement_snapshot_expanded_cy a 
	LEFT JOIN ref_year ry ON a.fiscal_year = ry.year_value 
	LEFT JOIN subcontract_spending_details b ON a.original_agreement_id = b.agreement_id AND a.fiscal_year = b.calendar_fiscal_year 
	WHERE   a.status_flag='R' 
	GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13 ",57
SubVenContractsForSumAndTotals,aggregateon_subven_total_contracts,"CREATE TABLE aggregateon_subven_total_contracts
(
fiscal_year smallint,
fiscal_year_id smallint,
vendor_id int,
prime_vendor_id int,
prime_minority_type_id smallint,
minority_type_id smallint,
award_method_id smallint,
agency_id smallint,
industry_type_id smallint,
award_size_id smallint,
total_contracts bigint,
total_commited_contracts bigint,
total_master_agreements bigint,
total_standalone_contracts bigint,
total_revenue_contracts bigint,
total_revenue_contracts_amount numeric(16,2),
total_commited_contracts_amount numeric(16,2),
total_contracts_amount numeric(16,2),
total_spending_amount_disb numeric(16,2), 
total_spending_amount numeric(16,2), 
status_flag char(1),
type_of_year char(1)
) DISTRIBUTED BY (fiscal_year)","SELECT 	fiscal_year, 
		fiscal_year_id,
		vendor_id,
		prime_vendor_id,
		prime_minority_type_id,
		minority_type_id,
		award_method_id,
		agency_id,
		industry_type_id,
		award_size_id,
		SUM(CASE WHEN b.document_code IN ('MA1','MMA1','CT1','CTA1') THEN 1 ELSE 0 END) AS    total_contracts,
		SUM(CASE WHEN b.document_code IN ('MA1','MMA1','CT1') THEN 1 ELSE 0 END) AS total_commited_contracts,
		SUM(CASE WHEN b.document_code IN ('MA1','MMA1') THEN 1 ELSE 0 END) AS total_master_agreements,
		SUM(CASE WHEN b.document_code IN ('CT1','CTA1') THEN  1 ELSE 0 END) AS total_standalone_contracts,
		SUM(CASE WHEN b.document_code IN ('RCT1') THEN  1 ELSE 0 END) AS total_revenue_contracts,
		SUM(CASE WHEN b.document_code IN ('RCT1') THEN  maximum_contract_amount ELSE 0 END) AS total_revenue_contracts_amount,
		SUM(CASE WHEN b.document_code IN ('MA1','MMA1','CT1') THEN maximum_contract_amount ELSE 0 END) AS total_commited_contracts_amount,
		SUM(CASE WHEN b.document_code IN ('MA1','MMA1','CT1','CTA1') THEN maximum_contract_amount ELSE 0 END) AS total_contracts_amount,
		SUM(CASE WHEN b.document_code IN ('CT1','CTA1','DO1') THEN spending_amount_disb ELSE 0 END) as total_spending_amount_disb,
		SUM(CASE WHEN b.document_code IN ('CT1','CTA1','DO1') THEN spending_amount ELSE 0 END) as total_spending_amount,
		status_flag,
		type_of_year
FROM aggregateon_subven_contracts_cumulative_spending a LEFT JOIN ref_document_code b ON a.document_code_id = b.document_code_id
GROUP BY 1,2,3,4,5,6,7,8,9,10,21,22",,58
SubVenContractsSpendingTransactions,contracts_subven_spending_transactions,"CREATE TABLE contracts_subven_spending_transactions
(
disbursement_line_item_id bigint,
original_agreement_id bigint,
fiscal_year smallint,
fiscal_year_id smallint,
document_code_id smallint,
vendor_id int,
prime_vendor_id int,
prime_minority_type_id smallint,
minority_type_id smallint,
award_method_id smallint,
document_agency_id smallint,
industry_type_id smallint,
award_size_id smallint,
disb_document_id  character varying(20),
disb_vendor_name  character varying,
disb_check_eft_issued_date  date,
disb_agency_name  character varying(100),
disb_check_amount  numeric(16,2),
disb_contract_number  character varying,
disb_sub_contract_id  character varying,
disb_purpose  character varying,
disb_reporting_code  character varying(15),
disb_spending_category_name  character varying,
disb_agency_id  smallint,
disb_vendor_id  integer,
disb_spending_category_id  smallint,
disb_agreement_id  bigint,
disb_contract_document_code  character varying(8),
disb_fiscal_year_id  smallint,
disb_check_eft_issued_cal_month_id integer,
disb_disbursement_number character varying(40),
disb_minority_type_id smallint,
disb_minority_type_name character varying(50),
disb_vendor_type character(2),
disb_master_contract_number character varying,
status_flag char(1),
type_of_year char(1)
) DISTRIBUTED BY (disbursement_line_item_id)","SELECT 	d.disbursement_line_item_id, 
		a.original_agreement_id,
		a.fiscal_year,
		b.year_id,
		a.document_code_id,
		a.vendor_id,
		a.prime_vendor_id,
		a.prime_minority_type_id,
		a.minority_type_id,
		a.award_method_id,
		a.agency_id as document_agency_id,
		a.industry_type_id,
		a.award_size_id,
		d.document_id,
		d.vendor_name,
		d.check_eft_issued_date,
		d.agency_name,
		d.check_amount,
		d.contract_number,
		d.sub_contract_id,
		d.purpose,
		d.reporting_code,
		d.spending_category_name,
		d.agency_id,
		d.vendor_id,
		d.spending_category_id,
		d.agreement_id,
		d.contract_document_code,
		d.check_eft_issued_nyc_year_id,
		d.check_eft_issued_cal_month_id,
		d.disbursement_number,
		d.minority_type_id,
		d.minority_type_name,
		(CASE WHEN d.minority_type_id in (2,3,4,5,9) THEN 'SM' ELSE 'S' END) as disb_vendor_type,
		d.master_contract_number,
		'A' as status_flag,
		'B' as type_of_year
FROM   sub_agreement_snapshot_expanded a, ref_year b, subcontract_spending_details d
WHERE a.fiscal_year = b.year_value 
AND a.original_agreement_id = d.agreement_id  AND a.fiscal_year >= d.fiscal_year
AND a.status_flag='A' 
UNION ALL
 SELECT d.disbursement_line_item_id, 
		a.original_agreement_id,
		a.fiscal_year,
		b.year_id,
		a.document_code_id,
		a.vendor_id,
		a.prime_vendor_id,
		a.prime_minority_type_id,
		a.minority_type_id,
		a.award_method_id,
		a.agency_id as document_agency_id,
		a.industry_type_id,
		a.award_size_id,
		d.document_id,
		d.vendor_name,
		d.check_eft_issued_date,
		d.agency_name,
		d.check_amount,
		d.contract_number,
		d.sub_contract_id,
		d.purpose,
		d.reporting_code,
		d.spending_category_name,
		d.agency_id,
		d.vendor_id,
		d.spending_category_id,
		d.agreement_id,
		d.contract_document_code,
		d.check_eft_issued_nyc_year_id,
		d.check_eft_issued_cal_month_id,
		d.disbursement_number,
		d.minority_type_id,
		d.minority_type_name,
		(CASE WHEN d.minority_type_id in (2,3,4,5,9) THEN 'SM' ELSE 'S' END) as disb_vendor_type,
		d.master_contract_number,
		'R' as status_flag,
		'B' as type_of_year
FROM   sub_agreement_snapshot_expanded a, ref_year b, subcontract_spending_details d
WHERE a.fiscal_year = b.year_value 
AND a.original_agreement_id = d.agreement_id  AND a.fiscal_year >= d.fiscal_year
AND a.status_flag='R' ","SELECT d.disbursement_line_item_id, 
		a.original_agreement_id,
		a.fiscal_year,
		b.year_id,
		a.document_code_id,
		a.vendor_id,
		a.prime_vendor_id,
		a.prime_minority_type_id,
		a.minority_type_id,
		a.award_method_id,
		a.agency_id as document_agency_id,
		a.industry_type_id,
		a.award_size_id,
		d.document_id,
		d.vendor_name,
		d.check_eft_issued_date,
		d.agency_name,
		d.check_amount,
		d.contract_number,
		d.sub_contract_id,
		d.purpose,
		d.reporting_code,
		d.spending_category_name,
		d.agency_id,
		d.vendor_id,
		d.spending_category_id,
		d.agreement_id,
		d.contract_document_code,
		d.calendar_fiscal_year_id,
		d.check_eft_issued_cal_month_id,
		d.disbursement_number,
		d.minority_type_id,
		d.minority_type_name,
		(CASE WHEN d.minority_type_id in (2,3,4,5,9) THEN 'SM' ELSE 'S' END) as disb_vendor_type,
		d.master_contract_number,
		'A' as status_flag,
		'C' as type_of_year
FROM   sub_agreement_snapshot_expanded_cy a, ref_year b, subcontract_spending_details d
WHERE a.fiscal_year = b.year_value 
AND a.original_agreement_id = d.agreement_id  AND a.fiscal_year >= d.calendar_fiscal_year
AND a.status_flag='A'  
UNION ALL
SELECT 	d.disbursement_line_item_id, 
		a.original_agreement_id,
		a.fiscal_year,
		b.year_id,
		a.document_code_id,
		a.vendor_id,
		a.prime_vendor_id,
		a.prime_minority_type_id,
		a.minority_type_id,
		a.award_method_id,
		a.agency_id as document_agency_id,
		a.industry_type_id,
		a.award_size_id,
		d.document_id,
		d.vendor_name,
		d.check_eft_issued_date,
		d.agency_name,
		d.check_amount,
		d.contract_number,
		d.sub_contract_id,
		d.purpose,
		d.reporting_code,
		d.spending_category_name,
		d.agency_id,
		d.vendor_id,
		d.spending_category_id,
		d.agreement_id,
		d.contract_document_code,
		d.calendar_fiscal_year_id,
		d.check_eft_issued_cal_month_id,
		d.disbursement_number,
		d.minority_type_id,
		d.minority_type_name,
		(CASE WHEN d.minority_type_id in (2,3,4,5,9) THEN 'SM' ELSE 'S' END) as disb_vendor_type,
		d.master_contract_number,
		'R' as status_flag,
		'C' as type_of_year
FROM   sub_agreement_snapshot_expanded_cy a, ref_year b, subcontract_spending_details d
WHERE a.fiscal_year = b.year_value 
AND a.original_agreement_id = d.agreement_id  AND a.fiscal_year >= d.calendar_fiscal_year
AND a.status_flag='R'  ",60
AllContractLandingWidgets,aggregateon_all_contracts_cumulative_spending,"CREATE TABLE aggregateon_all_contracts_cumulative_spending(
	original_agreement_id bigint,
	fiscal_year smallint,
	fiscal_year_id smallint,
	document_code_id smallint,
	master_agreement_yn character(1),
	description varchar,
	contract_number varchar,
	sub_contract_id character varying(20),
	vendor_id int,
	prime_vendor_id int,
	prime_minority_type_id smallint,
	minority_type_id smallint,
	award_method_id smallint,
	agency_id smallint,
	industry_type_id smallint,
	award_size_id smallint,
	original_contract_amount numeric(16,2),
	maximum_contract_amount numeric(16,2),
	spending_amount_disb numeric(16,2),
	spending_amount numeric(16,2),
	current_year_spending_amount numeric(16,2),
	dollar_difference numeric(16,2),
	percent_difference numeric(16,2),
	status_flag char(1),
	type_of_year char(1)	
) DISTRIBUTED BY (vendor_id)","SELECT 
            original_agreement_id, 
            fiscal_year, 
            fiscal_year_id, 
            document_code_id, 
            master_agreement_yn, 
            description, 
            contract_number, 
            NULL as sub_contract_id,
            vendor_id, 
            NULL as prime_vendor_id,
            NULL as prime_minority_type_id,
            minority_type_id, 
            award_method_id, 
            agency_id, 
            industry_type_id, 
            award_size_id, 
            original_contract_amount, 
            maximum_contract_amount, 
            spending_amount_disb, 
            spending_amount, 
            current_year_spending_amount, 
            dollar_difference, 
            percent_difference, 
            status_flag, 
            type_of_year  FROM aggregateon_mwbe_contracts_cumulative_spending ","SELECT 
            original_agreement_id, 
            fiscal_year, 
            fiscal_year_id, 
            document_code_id, 
            NULL as master_agreement_yn, 
            description, 
            contract_number, 
            sub_contract_id,
            vendor_id, 
            prime_vendor_id,
            prime_minority_type_id,
            minority_type_id, 
            award_method_id, 
            agency_id, 
            industry_type_id, 
            award_size_id, 
            original_contract_amount, 
            maximum_contract_amount, 
            spending_amount_disb, 
            spending_amount, 
            current_year_spending_amount, 
            dollar_difference, 
            percent_difference, 
            status_flag, 
            type_of_year  FROM aggregateon_subven_contracts_cumulative_spending",61
AllContractsSpendingTransactions,contracts_all_spending_transactions,"CREATE TABLE contracts_all_spending_transactions
(
disbursement_line_item_id bigint,
original_agreement_id bigint,
fiscal_year smallint,
fiscal_year_id smallint,
document_code_id smallint,
vendor_id int,
prime_vendor_id integer,
prime_minority_type_id smallint,
minority_type_id smallint,
award_method_id smallint,
document_agency_id smallint,
industry_type_id smallint,
award_size_id smallint,
disb_document_id  character varying(20),
disb_vendor_name  character varying,
disb_check_eft_issued_date  date,
disb_agency_name  character varying(100),
disb_department_short_name  character varying(15),
disb_check_amount  numeric(16,2),
disb_expenditure_object_name  character varying(40),
disb_budget_name  character varying(60),
disb_contract_number  character varying,
disb_sub_contract_id character varying,
disb_purpose  character varying,
disb_reporting_code  character varying(15),
disb_spending_category_name  character varying,
disb_agency_id  smallint,
disb_vendor_id  integer,
disb_expenditure_object_id  integer,
disb_department_id  integer,
disb_spending_category_id  smallint,
disb_agreement_id  bigint,
disb_contract_document_code  character varying(8),
disb_master_agreement_id  bigint,
disb_fiscal_year_id  smallint,
disb_check_eft_issued_cal_month_id integer,
disb_disbursement_number character varying(40),
disb_minority_type_id smallint,
disb_minority_type_name character varying(50),
disb_vendor_type character(2),
status_flag char(1),
type_of_year char(1),
is_prime_or_sub character(1)
) DISTRIBUTED BY (disbursement_line_item_id)","SELECT disbursement_line_item_id, 
original_agreement_id, 
fiscal_year, 
fiscal_year_id,
document_code_id, 
vendor_id, 
vendor_id as prime_vendor_id,
minority_type_id as prime_minority_type_id,
minority_type_id,
award_method_id, 
document_agency_id, 
industry_type_id, 
award_size_id, 
disb_document_id, 
disb_vendor_name, 
disb_check_eft_issued_date, 
disb_agency_name, 
disb_department_short_name, 
disb_check_amount, 
disb_expenditure_object_name, 
disb_budget_name, 
disb_contract_number, 
NULL as disb_sub_contract_id,
disb_purpose, 
disb_reporting_code, 
disb_spending_category_name, 
disb_agency_id, 
disb_vendor_id, 
disb_expenditure_object_id, 
disb_department_id, 
disb_spending_category_id, 
disb_agreement_id, 
disb_contract_document_code, 
disb_master_agreement_id, 
disb_fiscal_year_id, 
disb_check_eft_issued_cal_month_id, 
disb_disbursement_number, 
disb_minority_type_id, 
disb_minority_type_name, 
disb_vendor_type, 
status_flag, 
type_of_year,
'P' as is_prime_or_sub
FROM contracts_mwbe_spending_transactions ","SELECT disbursement_line_item_id, 
original_agreement_id, 
fiscal_year, 
fiscal_year_id,
document_code_id, 
vendor_id, 
prime_vendor_id,
prime_minority_type_id,
minority_type_id,
award_method_id, 
document_agency_id, 
industry_type_id, 
award_size_id, 
disb_document_id, 
disb_vendor_name, 
disb_check_eft_issued_date, 
disb_agency_name, 
NULL as disb_department_short_name, 
disb_check_amount, 
NULL as disb_expenditure_object_name, 
NULL as disb_budget_name, 
disb_contract_number, 
disb_sub_contract_id,
disb_purpose, 
disb_reporting_code, 
disb_spending_category_name, 
disb_agency_id, 
disb_vendor_id, 
NULL as disb_expenditure_object_id, 
NULL as disb_department_id, 
disb_spending_category_id, 
disb_agreement_id, 
disb_contract_document_code, 
NULL as disb_master_agreement_id, 
disb_fiscal_year_id, 
disb_check_eft_issued_cal_month_id, 
disb_disbursement_number, 
disb_minority_type_id, 
disb_minority_type_name, 
disb_vendor_type, 
status_flag, 
type_of_year,
'S' as is_prime_or_sub
FROM contracts_subven_spending_transactions",62