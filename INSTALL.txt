CONTENTS OF THIS FILE
---------------------

 * Requirements
 * Optional requirements for scalability and performance
 * Installation
 
 The distribution provided includes the following components.
- Drupal source with additional custom modules and contrib modules used in checkbook. 
- Drupal database, which should be loaded in to a mysql database.
- PostgreSQL dump which contains the sample data for checkbook.

REQUIREMENTS 
-------------

Checkbook requires:

- Drupal 7.*
	- Linux 
	- PHP 5.3 or greater	
- Databases:
	- MySQL 5.0.15 (or greater) for drupal data.	
	- PostgreSQL 8.3 (or greater) (http://www.postgresql.org/)., Any database that supports postgresSQL is compatible for storing checkbook data (Eg. Greenplum, Postgres). 
- Apache with following php extensions
	- php intl extension. http://php.net/manual/en/intl.setup.php
	- php postgres extension. http://www.php.net/manual/en/pgsql.setup.php
- psql client (Postgres command line interface). 	
- Solr 4.*, open source enterprise search platform.
- Drush version 5.0


OPTIONAL REQUIREMENTS FOR SCALABILITY AND PERFORMANCE
------------------------------------------------------

- A load balancer for distributing requests across multiple instances.
- Varnish or any other reverse proxy cache for caching last access pages.
- PGPool for distributing load across multiple postgreSQL or Greenplum databases.

INSTALLATION
------------

It is assumed that a linux server with LAMP stack is installed. 

The following assumptions are made about the installation.
- Webroot is /var/www/html.
- drupal database schema name is checkbook_drupal.
- postgreSQL database schema name is checkbook.

1. Download and Install Drupal Code.

- Download the latest version of checkbook code from the following location <location will be updated>. Copy the contents of the folder webapp to the webroot directory.
- copy default.settings.php from <Webroot>/sites/default/default.settings.php to <Webroot>/sites/default/settings.php 

2. Copy the required third party libraries.

- Highcharts installation 
	-download version 3.0.1 from http://www.highcharts.com/products/highcharts and copy to webroot/sites/all/modules/dashboard_platform/widget_highcharts/highcharts/3.0.1
		verify that path to highcharts.src.js to webroot/sites/all/modules/dashboard_platform/widget_highcharts/highcharts/3.0.1/js/highcharts.src.js
- Highstock installation 
	-download version 1.2.4 from http://www.highcharts.com/products/highstock
		verify that path to  highstock.src.js to webroot/sites/all/modules/dashboard_platform/widget_highcharts/highstock/1.2.4/js/highstock.src.js
   

3. Install the Drupal database.
- Download the drupal database from the following location. Create and import the database into mysql using the following commands.
		mysql -u<username> -p<password>
		create database checkbook_drupal
		use checkbook_drupal
		source <path to downloaded sql file>

4. Install postgreSQL database.
- Download the postgreSQL database file from the following location. Create and import the database into postgres using the following commands.
	Psql -Upostgres    -- enter the password for postgres user
	create database checkbook ;
	\q   -- to come out of the database
	psql -Upostgres checkbook -f <path to psql dump file>  -- enter the password for postgres user
- verify that one can connect to postgres db using the command
	PGPASSWORD=password psql -h ip -U username db

5. Install Solr and configure settings


- refer to SOLR-INSTALL.txt for installation of solr for different web servers. 
- reindex solr by using the following command. http://<solr-host>:<solr-port>/<solr webapp name>/dataimport?command=full-import&clean=true&jobID=0
- update the following settings in webroot/sites/default/settings.php
	- update settings.php with url of solr instance.
	//Solr URL
	$conf['check_book']['solr']['url'] = 'http://<solr server ip>:<solr server port>/<solr instance name>/';
	- update this setting to a path on the disk which is writable by the user running apache.
	$conf['check_book']['data_feeds']['db_file_dir'] = '/data/datafeeds';

	- update this setting if the path for the file generated by datafeeds should be in a different directory
	//relative directory path to 'sites/default/files' to store generated files
	$conf['check_book']['data_feeds']['output_file_dir'] = 'datafeeds';

	- update this setting with url of the site. this is inlcuded in email notifications.
	$conf['check_book']['data_feeds']['site_url'] = 'http://<site url>';

	- update this setting to change location of reference data text files. 
	//Reference data outputDirectory
	$conf['check_book']['ref_data_dir'] = 'refdata';

	- This setting is used to specify the location of the temporary files when doing export through the application.
	//Export data outputDirectory
	$conf['check_book']['export_data_dir'] = 'exportdata';

	- This setting is used to limit the number of records for the export file.
	//no of records to limit for datatables
	$conf['check_book']['datatables']['iTotalDisplayRecords'] = 200000;

	// update the command for psql.
	$conf['check_book']['data_feeds']['command'] = 'PGPASSWORD=<password> psql -h <postgres-db-ip> -U <postgres-db-user> <postgresdb-name>'
6. Install or Modify Fonts	

Checkbook uses novecento wide normal font on the site. To download the fonts goto
http://www.myfonts.com/fonts/synthview/novecento/wide-normal/buy.html
copy font files Novecentowide-Normal-webfont.eot, Novecentowide-Normal-webfont.svg, Novecentowide-Normal-webfont.ttf, Novecentowide-Normal-webfont.woff  
to webapp/sites/all/themes/checkbook3/fonts/
Fonts on the site can be changed by editing the files
webapp/sites/all/themes/checkbook3/fonts/fonts.css
webapp/sites/all/themes/checkbook3/css/fontfamily.css

7. Cron jobs
- add the following entries to cron tab.

*/15 * * * * root /usr/bin/php <path to drush>/drush.php --root="<html web root>" scr processQueueJob --script-path="sites/all/modules/custom/checkbook_api/script/" >> /dev/null 2>&1
*/5 * * * * root /usr/bin/php <path to drush>/drush.php --root="<html web root>" scr sendFeedCompletionEmails  --script-path="sites/all/modules/custom/checkbook_datafeeds/script/" >> /dev/null 2>&1

8. Verify that the site is working.
- launch the site by accessing the url. Default page is spending transactions page for current fiscal year.
- click on search button and should see the search results page.
- start typing any name in the search box and autocomplete results should appear.
- click on advanced search and click on submit. results page should appear.
- click on export in advances search results page to verfiy that export is working.

